## Introduction

Introduction…

## Before to start

Before to start…

## Notame workflow

As a first step…

``` r
# Notame package installation
#if (!requireNamespace("devtools", quietly = TRUE)) {
#  install.packages("devtools")
#}
#devtools::install_github("antonvsdata/notame", ref = "v0.3.1")

#Library´s
library(usethis)
library(devtools)
library(shiny)
library(foreach)
library(iterators)
library(parallel)
library(ggplot2)
library(doParallel) 
library(magrittr)  
library(tidyverse) 
library(patchwork) 
library(dplyr)
library(here)
library(gplots)
library(notame)
library(doParallel)
#remotes::install_gitlab("CarlBrunius/batchCorr")
library(batchCorr)
library(ggplot2)
#install.packages("ggrepel")
library(ggrepel)
#install.packages("hexbin")
library(hexbin)
```

    ## Warning: package 'hexbin' was built under R version 4.4.3

``` r
#install.packages("Hmisc")
library(Hmisc)
```

    ## Warning: package 'Hmisc' was built under R version 4.4.3

``` r
# Notame library call
library(notame)

# Dependency packages installation
install_dependencies
```

    ## function (preprocessing = TRUE, extra = FALSE, batch_corr = FALSE, 
    ##     misc = FALSE, ...) 
    ## {
    ##     core_cran <- c("BiocManager", "cowplot", "missForest", "openxlsx", 
    ##         "randomForest", "RColorBrewer", "Rtsne")
    ##     core_bioconductor <- "pcaMethods"
    ##     extra_cran <- c("car", "doParallel", "devEMF", "ggbeeswarm", 
    ##         "ggdendro", "ggrepel", "ggtext", "Hmisc", "hexbin", "igraph", 
    ##         "lme4", "lmerTest", "MuMIn", "PERMANOVA", "PK", "rmcorr")
    ##     extra_bioconductor <- c("mixOmics", "supraHex")
    ##     extra_gitlab <- "CarlBrunius/MUVR"
    ##     batch_cran <- "fpc"
    ##     batch_bioconductor <- "RUVSeq"
    ##     batch_github <- NULL
    ##     batch_gitlab <- "CarlBrunius/batchCorr"
    ##     misc_cran <- c("knitr", "rmarkdown", "testthat")
    ##     if (preprocessing) {
    ##         install_helper(cran = core_cran, bioconductor = core_bioconductor, 
    ##             ...)
    ##     }
    ##     if (extra) {
    ##         install_helper(cran = extra_cran, bioconductor = extra_bioconductor, 
    ##             gitlab = extra_gitlab, ...)
    ##     }
    ##     if (batch_corr) {
    ##         install_helper(cran = batch_cran, bioconductor = batch_bioconductor, 
    ##             github = batch_github, gitlab = batch_gitlab, ...)
    ##     }
    ##     if (misc) {
    ##         install_helper(cran = misc_cran, ...)
    ##     }
    ## }
    ## <bytecode: 0x0000017e286175b0>
    ## <environment: namespace:notame>

Then, a main path and a log system was added to have a record of each
process executed.

``` r
# Main path
ppath <- "E:/Paper/results"
# Log system
init_log(log_file = 'E:/Paper/results/log_LC-MS_Negative_3.txt')
```

    ## INFO [2025-04-08 11:23:28] Starting logging

Next…

``` r
data <- read_from_excel(file = "E:/Paper/results/Libro3.xlsx", sheet = 4, 
                        corner_row = 9, corner_column = "I", 
                        split_by = c("Column", "Ion Mode"))
```

    ## INFO [2025-04-08 11:23:29] Corner detected correctly at row 9, column I
    ## INFO [2025-04-08 11:23:29] 
    ## Extracting sample information from rows 1 to 9 and columns J to DF
    ## INFO [2025-04-08 11:23:29] Replacing spaces in sample information column names with underscores (_)
    ## INFO [2025-04-08 11:23:29] Naming the last column of sample information "Datafile"
    ## INFO [2025-04-08 11:23:29] 
    ## Extracting feature information from rows 10 to 1765 and columns A to I
    ## INFO [2025-04-08 11:23:29] Creating Split column from Column, Ion Mode
    ## INFO [2025-04-08 11:23:30] Feature_ID column not found, creating feature IDs
    ## INFO [2025-04-08 11:23:30] Identified m/z column row m/z and retention time column row retention time
    ## INFO [2025-04-08 11:23:30] Identified m/z column row m/z and retention time column row retention time
    ## INFO [2025-04-08 11:23:30] Creating feature IDs from Split, m/z and retention time
    ## INFO [2025-04-08 11:23:30] Replacing dots (.) in feature information column names with underscores (_)
    ## INFO [2025-04-08 11:23:30] 
    ## Extracting feature abundances from rows 10 to 1765 and columns J to DF
    ## INFO [2025-04-08 11:23:30] 
    ## Checking sample information
    ## INFO [2025-04-08 11:23:30] QC column generated from rows containing 'QC'
    ## INFO [2025-04-08 11:23:30] Sample ID autogenerated from injection orders and prefix ID_
    ## INFO [2025-04-08 11:23:30] Checking that feature abundances only contain numeric values
    ## INFO [2025-04-08 11:23:30] 
    ## Checking feature information
    ## INFO [2025-04-08 11:23:30] Checking that feature IDs are unique and not stored as numbers
    ## INFO [2025-04-08 11:23:30] Checking that m/z and retention time values are reasonable
    ## INFO [2025-04-08 11:23:30] Identified m/z column row_m_z and retention time column row_retention_time
    ## INFO [2025-04-08 11:23:30] Identified m/z column row_m_z and retention time column row_retention_time

Once the data is read, the next step was…

``` r
modes <- construct_metabosets(exprs = data$exprs, 
                              pheno_data = data$pheno_data, 
                              feature_data = data$feature_data,
                              group_col = "Group")
```

    ## Initializing the object(s) with unflagged features
    ## INFO [2025-04-08 11:23:30] 
    ## Checking feature information
    ## INFO [2025-04-08 11:23:30] Checking that feature IDs are unique and not stored as numbers
    ## INFO [2025-04-08 11:23:30] Checking that feature abundances only contain numeric values
    ## INFO [2025-04-08 11:23:30] Setting row and column names of exprs based on feature and pheno data

Raw data inspection.

``` r
# Data extraction
mode_test <- modes$RP_NEG
# Boxplot of raw data
raw_bp <- plot_sample_boxplots(mode_test,
                               order_by = "Factor",
                               fill_by = "Factor")
# PCA of raw data
raw_pca <- plot_pca(mode_test,
                    center = TRUE,
                    shape = "Factor",
                    color = "Factor")
# Package to plots visualization in a same windows
#if (!requireNamespace("devtools", quietly = TRUE)) {
#  install.packages("devtools")
#}
#devtools::install_github("thomasp85/patchwork")
library(patchwork)
# Plot
raw_pca + raw_bp
```

![](Multivariate_Statistics_new_NEG_files/figure-markdown_github/unnamed-chunk-5-1.png)

## Preprocessing

The first step is…

``` r
# Data extraction
mode <- modes$RP_NEG
# Change 0 value to NA
mode <- mark_nas(mode, value = 0)
```

Then…

``` r
# Low detection rate
mode <- flag_detection(mode, qc_limit = 12/14, group_limit = 2/3)
```

    ## INFO [2025-04-08 11:23:33] 
    ## 1% of features flagged for low detection rate

``` r
# Some statistics after low detection algorithm
#visualizations(mode,
#               prefix = paste0(ppath,
#                               "Result/notame_Result/HS_GCMS/Figure/",
#                               "Low_Detection")
#               )
```

The next step…

``` r
# Drift correction
corrected <- correct_drift(mode)
```

    ## INFO [2025-04-08 11:23:33] 
    ## Starting drift correction at 2025-04-08 11:23:33.689328

    ## INFO [2025-04-08 11:23:38] Drift correction performed at 2025-04-08 11:23:38.977351
    ## INFO [2025-04-08 11:23:40] Inspecting drift correction results 2025-04-08 11:23:40.659851
    ## INFO [2025-04-08 11:23:44] Drift correction results inspected at 2025-04-08 11:23:44.469763
    ## INFO [2025-04-08 11:23:44] 
    ## Drift correction results inspected, report:
    ## Drift_corrected: 100%,  Missing_QCS: 0%

``` r
# Flag low quality features
corrected <- flag_quality(corrected,
                          condition = "RSD_r < 0.15 & D_ratio_r < 0.86")
```

    ## INFO [2025-04-08 11:23:44] 
    ## 18% of features flagged for low quality

``` r
# Exporting data to inspect drift correction
#write_to_excel(corrected,
#               "E:/Paper/results/MZmine_drifft_1.xlsx")
```

Then we can visualize the data after drift correction.

``` r
# Boxplot
corr_bp <- plot_sample_boxplots(corrected,
                                order_by = "Factor",
                                fill_by = "Factor")
# PCA
corr_pca <- plot_pca(corrected,
                     center = TRUE,
                     shape = "Factor",
                     color = "Factor")
# Plot
corr_pca + corr_bp
```

![](Multivariate_Statistics_new_NEG_files/figure-markdown_github/unnamed-chunk-10-1.png)

Contaminant…

``` r
# Removal of contaminants
corrected_blank <- flag_contaminants(corrected,
                                        blank_col = "Group",
                                        blank_label = "Blank",
                                        flag_thresh = 0.80,
                                        flag_label = "Contaminant")
```

    ## INFO [2025-04-08 11:23:46] 
    ## 29% of features flagged as contaminants

``` r
# Removal blank group from dataset
corrected_blank <- corrected_blank[, corrected_blank$Group != "Blank"]
pData(corrected_blank) <- droplevels(pData(corrected_blank))
# Exporting data to clean identified features
#write_to_excel(corrected_blank,
#               "E:/Paper/results/MZmine_corrected_no_blank_1.xlsx")
```

Dta visualization…

``` r
# Boxplot
blank_bp <- plot_sample_boxplots(corrected_blank,
                                 order_by = "Factor",
                                 fill_by = "Factor")
# PCA
blank_pca <- plot_pca(corrected_blank,
                      center = TRUE,
                      shape = "Factor",
                      color = "Factor")
# Plot
blank_pca + blank_bp
```

![](Multivariate_Statistics_new_NEG_files/figure-markdown_github/unnamed-chunk-12-1.png)

``` r
#More stadistics
# Some statistics after low detection algorithm
#visualizations(corrected_blank,
#               prefix = paste0(ppath,
#                               "/LC_MS-driff/Figure",
#                               "Low_Detection")
#)
```

The next step…

``` r
clustered <- cluster_features(corrected_blank,
                              rt_window = 1/60,
                              corr_thresh = 0.95,
                              d_thresh = 0.8,
                              #plotting = FALSE,
                              #prefix = paste0(ppath, "/HS_GCMS/Figure","Cluster")
)
```

    ## INFO [2025-04-08 11:23:48] Identified m/z column row_m_z and retention time column row_retention_time
    ## INFO [2025-04-08 11:23:48] 
    ## Starting feature clustering at 2025-04-08 11:23:48.957986
    ## INFO [2025-04-08 11:23:48] Finding connections between features in RP_NEG
    ## [1] 100
    ## [1] 200
    ## [1] 300
    ## [1] 400
    ## [1] 500
    ## [1] 600
    ## [1] 700
    ## [1] 800
    ## [1] 900
    ## INFO [2025-04-08 11:24:13] Found 1787 connections in RP_NEG
    ## INFO [2025-04-08 11:24:13] Found 1787 connections
    ## 52 components found
    ## 
    ## 46 components found
    ## 
    ## 21 components found
    ## 
    ## 10 components found
    ## 
    ## 3 components found
    ## 
    ## INFO [2025-04-08 11:24:14] Found 84 clusters of 2 or more features, clustering finished at 2025-04-08 11:24:14.448036

``` r
compressed <- compress_clusters(clustered)
```

    ## INFO [2025-04-08 11:24:14] Clusters compressed, left with 635 features

``` r
# Exporting data to inspect cluster features
#write_to_excel(clustered,
#               "E:/Paper/results/MZmine_clustered_no_blank_cluster_4.xlsx")

# Exporting data to inspect compressed features
#write_to_excel(compressed,
#               "E:/Paper/results/MZmine_compressed_no_blank_cluster_4.xlsx")
```

We can visualize data…

``` r
# Boxplot
clust_bp <- plot_sample_boxplots(compressed,
                                 order_by = "Factor",
                                 fill_by = "Factor")
# PCA
clust_pca <- plot_pca(compressed,
                      center = TRUE,
                      shape = "Factor",
                      color = "Factor")
# Plot
clust_pca + clust_bp
```

![](Multivariate_Statistics_new_NEG_files/figure-markdown_github/unnamed-chunk-14-1.png)

Finally the data is…

``` r
#save(imputed, file = paste0(ppath, "Result/notame_Result/HS_GCMS/Notame_HS_GC-MS_out.RData"))
```

# PCA plots

Here read this paper: <https://doi.org/10.1007%2Fs11306-016-1030-9>

``` r
# Impute missing values using random forest
# To clean data
set.seed(698)
imputed <- impute_rf(compressed)
# To all data
imputed <- impute_rf(imputed, all_features = TRUE)
```

We can inspect PCA plot after…

``` r
# Boxplot
imp_bp <- plot_sample_boxplots(imputed,
                               order_by = "Factor",
                               fill_by = "Factor")
# PCA
imp_pca <- plot_pca(imputed,
                    center = TRUE,
                    shape = "Factor",
                    color = "Factor")
# Plot
imp_pca + imp_bp
```

![](Multivariate_Statistics_new_NEG_files/figure-markdown_github/unnamed-chunk-17-1.png)

The next step…

``` r
# Probabilistic quotient normalization
pqn_set <- pqn_normalization(imputed,
                             ref = c("qc", "all"),
                             method = c("median", "mean"),
                             all_features = FALSE)
```

    ## INFO [2025-04-08 11:24:34] Starting PQN normalization
    ## INFO [2025-04-08 11:24:34] Using median of qc samples as reference spectrum

We can inspect PCA plot after…

``` r
# Boxplot
pqn_bp <- plot_sample_boxplots(pqn_set,
                               order_by = "Factor",
                               fill_by = "Factor")
# PCA
pqn_pca <- plot_pca(pqn_set,
                    center = TRUE,
                    shape = "Factor",
                    color = "Factor")
# Plot
pqn_pca + pqn_bp
```

![](Multivariate_Statistics_new_NEG_files/figure-markdown_github/unnamed-chunk-19-1.png)

``` r
# Extract clean data
ppm_noflag <- drop_flagged(pqn_set)
# "SummarizedExperiment" package installation
#if (!require("BiocManager", quietly = TRUE))
#    install.packages("BiocManager")
#BiocManager::install("SummarizedExperiment")
library(SummarizedExperiment)
```

    ## Cargando paquete requerido: MatrixGenerics

    ## Cargando paquete requerido: matrixStats

    ## 
    ## Adjuntando el paquete: 'matrixStats'

    ## The following objects are masked from 'package:Biobase':
    ## 
    ##     anyMissing, rowMedians

    ## The following object is masked from 'package:dplyr':
    ## 
    ##     count

    ## 
    ## Adjuntando el paquete: 'MatrixGenerics'

    ## The following objects are masked from 'package:matrixStats':
    ## 
    ##     colAlls, colAnyNAs, colAnys, colAvgsPerRowSet, colCollapse,
    ##     colCounts, colCummaxs, colCummins, colCumprods, colCumsums,
    ##     colDiffs, colIQRDiffs, colIQRs, colLogSumExps, colMadDiffs,
    ##     colMads, colMaxs, colMeans2, colMedians, colMins, colOrderStats,
    ##     colProds, colQuantiles, colRanges, colRanks, colSdDiffs, colSds,
    ##     colSums2, colTabulates, colVarDiffs, colVars, colWeightedMads,
    ##     colWeightedMeans, colWeightedMedians, colWeightedSds,
    ##     colWeightedVars, rowAlls, rowAnyNAs, rowAnys, rowAvgsPerColSet,
    ##     rowCollapse, rowCounts, rowCummaxs, rowCummins, rowCumprods,
    ##     rowCumsums, rowDiffs, rowIQRDiffs, rowIQRs, rowLogSumExps,
    ##     rowMadDiffs, rowMads, rowMaxs, rowMeans2, rowMedians, rowMins,
    ##     rowOrderStats, rowProds, rowQuantiles, rowRanges, rowRanks,
    ##     rowSdDiffs, rowSds, rowSums2, rowTabulates, rowVarDiffs, rowVars,
    ##     rowWeightedMads, rowWeightedMeans, rowWeightedMedians,
    ##     rowWeightedSds, rowWeightedVars

    ## The following object is masked from 'package:Biobase':
    ## 
    ##     rowMedians

    ## Cargando paquete requerido: GenomicRanges

    ## Cargando paquete requerido: stats4

    ## Cargando paquete requerido: S4Vectors

    ## 
    ## Adjuntando el paquete: 'S4Vectors'

    ## The following object is masked from 'package:gplots':
    ## 
    ##     space

    ## The following objects are masked from 'package:lubridate':
    ## 
    ##     second, second<-

    ## The following objects are masked from 'package:dplyr':
    ## 
    ##     first, rename

    ## The following object is masked from 'package:tidyr':
    ## 
    ##     expand

    ## The following object is masked from 'package:utils':
    ## 
    ##     findMatches

    ## The following objects are masked from 'package:base':
    ## 
    ##     expand.grid, I, unname

    ## Cargando paquete requerido: IRanges

    ## 
    ## Adjuntando el paquete: 'IRanges'

    ## The following object is masked from 'package:lubridate':
    ## 
    ##     %within%

    ## The following objects are masked from 'package:dplyr':
    ## 
    ##     collapse, desc, slice

    ## The following object is masked from 'package:purrr':
    ## 
    ##     reduce

    ## The following object is masked from 'package:grDevices':
    ## 
    ##     windows

    ## Cargando paquete requerido: GenomeInfoDb

    ## 
    ## Adjuntando el paquete: 'GenomicRanges'

    ## The following object is masked from 'package:magrittr':
    ## 
    ##     subtract

``` r
# Convert feature height table to SummarizedExperiment class
pmp_data <- SummarizedExperiment(assays = exprs(ppm_noflag),
                                 colData = ppm_noflag@phenoData@data)
# Package for generalized logarithmic transform
#if (!requireNamespace("BiocManager", quietly = TRUE))
#    install.packages("BiocManager")
#BiocManager::install("pmp")
library(pmp)
# Generalised logarithmic transform
glog_exprs <- glog_transformation(df = pmp_data@assays@data@listData[[1]],
                                  classes = pmp_data$QC,
                                  qc_label = "QC")
# Adding glog transformation to notame MetaboSet
glog_set <- ppm_noflag
exprs(glog_set) <- glog_exprs
```

# Volcano Plot

``` r
# Removal of sample group from the dataset
volc_glog <- glog_set[, glog_set$Analysis_group != "Sample"]
pData(volc_glog) <- droplevels(pData(volc_glog))
# Drop QC
volc_glog <- drop_qcs(volc_glog)
# Extracting SubQC light factor
volc_glog <- volc_glog[, volc_glog$Light_Factor != "Other enviroment factors"]
pData(volc_glog) <- droplevels(pData(volc_glog))
```

``` r
# Removal of sample group from the dataset
volc_pqn <- ppm_noflag[, ppm_noflag$Analysis_group != "Sample"]
pData(volc_pqn) <- droplevels(pData(volc_pqn))
# Drop QC
volc_pqn <- drop_qcs(volc_pqn)
# Extracting SubQC light factor
volc_pqn <- volc_pqn[, volc_pqn$Light_Factor != "Other enviroment factors"]
pData(volc_pqn) <- droplevels(pData(volc_pqn))
```

``` r
# Performing homoscedasticity test
volc_th <-
  perform_homoscedasticity_tests(volc_glog,
                                 formula_char = "Feature ~ Light_Factor")
```

    ## INFO [2025-04-08 11:24:41] Starting homoscedasticity tests.
    ## INFO [2025-04-08 11:24:45] Homoscedasticity tests performed.

``` r
# Library to left_join use
library(dplyr)
# Fold change between shade and light levels
volc_fc <- fold_change(volc_pqn, group = "Light_Factor")
```

    ## INFO [2025-04-08 11:24:45] Starting to compute fold changes.
    ## INFO [2025-04-08 11:24:45] Fold changes computed.

``` r
# two-sample t-test performing
volc_t <- perform_t_test(volc_glog,
                         formula_char = "Feature ~ Light_Factor",
                         var.equal = TRUE)
```

    ## Remember that t.test returns difference between group means in different order than lm.
    ## This function mimics this behavior, so the effect size is mean of reference level minus mean of second level.

    ## INFO [2025-04-08 11:24:45] Starting t-tests for Light & Shade
    ## INFO [2025-04-08 11:24:47] t-tests performed.

``` r
# Adding the fold change to the t-test data
volc_data <- left_join(volc_t, volc_fc)
```

    ## Joining with `by = join_by(Feature_ID)`

``` r
# Log-transform for visualization
volc_data$logP <- -log10(volc_data$Light_vs_Shade_t_test_P)
volc_data$log2_fc <- log2(volc_data$Shade_vs_Light_FC)
```

``` r
# Determine point colors based on significance and fold change
volc_data <- volc_data %>%
  mutate(point_color = case_when(
    Light_vs_Shade_t_test_P < 0.05 & log2_fc < -1 ~ "Down", # significantly down
    Light_vs_Shade_t_test_P < 0.05 & log2_fc > 1 ~ "Up",    # significantly up
    log2_fc < 1 & log2_fc > -1 ~ "No fold change",          # fold change < 2
    Light_vs_Shade_t_test_P > 0.05 & log2_fc < -1 | 
      Light_vs_Shade_t_test_P > 0.05 & log2_fc > 1 ~ "Fold change")) # fold change > 2
# Extracting feature identified
metab_data <- glog_set[!is.na(glog_set@featureData@data$Metabolite),]
# Extracting metabolite table
meta_table <- metab_data@featureData@data
# Creating a new small table of the annotated compounds
# Keep metabolites with p-value < 0.05
volc_compouds <- subset(volc_data, Light_vs_Shade_t_test_P < 0.05 |
                             point_color == "Fold change")
volc_compouds <- left_join(meta_table, volc_compouds)
# Volcano plot
vc_plot <- ggplot(volc_data, aes(log2_fc, logP, color = point_color)) +
  geom_point(size = 2, alpha = 0.4) +
  scale_colour_manual(values = c("No fold change" = "#808080",
                                 "Down" = "#4F9D4EFF",
                                 "Up" = "#ff80ff",
                                 "Fold change" = "#F5BC5CFF")) +
  theme_classic() +
  #theme(legend.position = "none") +
  #geom_point(data = volc_compouds,
  #           aes(shape = meta_table$Identification_level,
  #               color = meta_table$Identification_level),
  #           size = 2) +
  labs(#shape = 'Identification level',
       color = 'Color key') +
  ggrepel::geom_label_repel(data = volc_compouds,
                            aes(label = meta_table$Metabolite),
                            color = "black",
                            box.padding = 0.37,
                            label.padding = 0.22,
                            label.r = 0.30,
                            cex = 2.5,
                            max.overlaps = 20,
                            min.segment.length = 0,
                            seed = 42,) +
  xlab(bquote(Log[2](Shade/Light))) + ylab(bquote(-Log[10](p-value))) +
  scale_y_continuous(limits = c(0,15), labels = function(i) 10^-i,
                     expand=c(0.003, 0.003)) +
  theme(legend.position = c(0.887, 0.897),
        legend.background = element_rect(fill = "white", color = "black")) +
  theme(panel.grid = element_blank(),
        panel.border = element_rect(fill= "transparent")) +
  #geom_vline(xintercept = 1, linetype = "longdash", colour="gray") +
  #geom_vline(xintercept = -1, linetype = "longdash", colour="gray") +
  geom_vline(xintercept = 0, linetype = "longdash", colour="gray") +
  geom_hline(yintercept = -log10(0.05), linetype = "longdash", colour="gray")
vc_plot
```

![](Multivariate_Statistics_new_NEG_files/figure-markdown_github/unnamed-chunk-27-1.png)

``` r
# Save plot
#ggsave('E:/Paper/Estadistica_multivariable_negativo/volcano_subqc.pdf',
#       width = 7, height = 8, device='pdf', dpi="print")
#ggsave('E:/Paper/Estadistica_multivariable_negativo/volcano_subqc.png',
#       width = 7, height = 8, device='png', dpi="print")
```

``` r
# Removal of sample group from the dataset
sp_volc_glog <- glog_set[, glog_set$Analysis_group != "Sub_Quality_Control"]
pData(sp_volc_glog) <- droplevels(pData(sp_volc_glog))
# Drop QC
sp_volc_glog <- drop_qcs(sp_volc_glog)
```

``` r
# Removal of sample group from the dataset
sp_volc_pqn <- ppm_noflag[, ppm_noflag$Analysis_group != "Sub_Quality_Control"]
pData(sp_volc_pqn) <- droplevels(pData(sp_volc_pqn))
# Drop QC
sp_volc_pqn <- drop_qcs(sp_volc_pqn)
```

``` r
# Performing homoscedasticity test
sp_volc_th <-
  perform_homoscedasticity_tests(sp_volc_glog,
                                 formula_char = "Feature ~ Light_Factor")
```

    ## INFO [2025-04-08 11:24:48] Starting homoscedasticity tests.
    ## INFO [2025-04-08 11:24:51] Homoscedasticity tests performed.

``` r
# Adding homoscedasticity results to notame MetaboSet
sp_volc_glog <- join_fData(sp_volc_glog, sp_volc_th)
# Extracting features with equal variance
sp_volc_ttset <-
  sp_volc_glog[sp_volc_glog@featureData@data$Levene_P > 0.05,]
# Extracting features with unequal variance
sp_volc_wttset <-
  sp_volc_glog[sp_volc_glog@featureData@data$Levene_P < 0.05,]
```

``` r
# Fold change between shade and light levels
sp_volc_fc <- fold_change(sp_volc_pqn, group = "Light_Factor")
```

    ## INFO [2025-04-08 11:24:51] Starting to compute fold changes.
    ## INFO [2025-04-08 11:24:51] Fold changes computed.

``` r
# The two-sample t-test performing
sp_volc_tt <- perform_t_test(sp_volc_ttset,
                            formula_char = "Feature ~ Light_Factor",
                            var.equal = TRUE)
```

    ## Remember that t.test returns difference between group means in different order than lm.
    ## This function mimics this behavior, so the effect size is mean of reference level minus mean of second level.

    ## INFO [2025-04-08 11:24:52] Starting t-tests for Light & Shade
    ## INFO [2025-04-08 11:24:53] t-tests performed.

``` r
# Adding a tag for t-test results
sp_volc_tt <- sp_volc_tt %>%
  mutate(Statistic_test = case_when(
    Feature_ID != 0 ~ "Student's t-test"))
# The Welch's t-test performing
sp_volc_wtt <- perform_t_test(sp_volc_wttset,
                            formula_char = "Feature ~ Light_Factor",
                            var.equal = TRUE)
```

    ## Remember that t.test returns difference between group means in different order than lm.
    ## This function mimics this behavior, so the effect size is mean of reference level minus mean of second level.

    ## INFO [2025-04-08 11:24:53] Starting t-tests for Light & Shade
    ## INFO [2025-04-08 11:24:53] t-tests performed.

``` r
# Adding a tag for Welch's t-test results
sp_volc_wtt <- sp_volc_wtt %>%
  mutate(Statistic_test = case_when(
    Feature_ID != 0 ~ "Welch's t-test"))
# Merge Welch's t-test and Student's t-test
sp_volc_t <- rbind(sp_volc_tt, sp_volc_wtt)
# Adding the fold change to statistical results
sp_volc_data <- left_join(sp_volc_t, sp_volc_fc)
```

    ## Joining with `by = join_by(Feature_ID)`

``` r
# Log-transform for visualization
sp_volc_data$logP <- -log10(sp_volc_data$Light_vs_Shade_t_test_P)
sp_volc_data$log2_fc <- log2(sp_volc_data$Shade_vs_Light_FC)
```

``` r
# Determine point colors based on significance and fold change
sp_volc_data <- sp_volc_data %>%
  mutate(point_color = case_when(
    Light_vs_Shade_t_test_P < 0.05 & log2_fc < -1 ~ "Down", # significantly down
    Light_vs_Shade_t_test_P < 0.05 & log2_fc > 1 ~ "Up",    # significantly up
    log2_fc < 1 & log2_fc > -1 ~ "No fold change",          # fold change < 2
    Light_vs_Shade_t_test_P > 0.05 & log2_fc < -1 | 
      Light_vs_Shade_t_test_P > 0.05 & log2_fc > 1 ~ "Fold change")) # fold change > 2
# Creating a new small table of the annotated compounds
# Keep metabolites with p-value < 0.05
sp_volc_compouds <- subset(sp_volc_data, Light_vs_Shade_t_test_P < 0.05 |
                             point_color == "Fold change")
sp_volc_compouds <- left_join(meta_table, sp_volc_compouds)
# Volcano plot
sp_vc_plot <- ggplot(sp_volc_data, aes(log2_fc, logP)) +
  #geom_point(size = 2, alpha = 0.4) +
  scale_colour_manual(values = c("No fold change" = "#808080",
                                 "Down" = "#4F9D4EFF",
                                 "Up" = "#ff80ff",
                                 "Fold change" = "#F5BC5CFF")) +
  theme_classic() +
  #theme(legend.position = "none") +
  geom_point(data = sp_volc_data,
             aes(shape = Statistic_test,
                 color = point_color),
             size = 2.5,
             alpha = 0.4) +
  labs(shape = 'Statistical test',
       color = 'Color key') +
  ggrepel::geom_label_repel(data = sp_volc_compouds,
                            aes(label = meta_table$Metabolite),
                            color = "black",
                            box.padding = 0.37,
                            label.padding = 0.22,
                            label.r = 0.30,
                            cex = 2.5,
                            max.overlaps = 20,
                            min.segment.length = 0,
                            seed = 42) +
  xlab(bquote(Log[2](Shade/Light))) + ylab(bquote(-Log[10](p-value))) +
  scale_y_continuous(limits = c(0,15), labels = function(i) 10^-i,
                     expand=c(0.003, 0.003)) +
  theme(legend.position = c(0.887, 0.83),
        legend.background = element_rect(fill = "white", color = "black")) +
  theme(panel.grid = element_blank(),
        panel.border = element_rect(fill= "transparent")) +
  #geom_vline(xintercept = 1, linetype = "longdash", colour="gray") +
  #geom_vline(xintercept = -1, linetype = "longdash", colour="gray") +
  geom_vline(xintercept = 0, linetype = "longdash", colour="gray") +
  geom_hline(yintercept = -log10(0.05), linetype = "longdash", colour="gray")
sp_vc_plot
```

![](Multivariate_Statistics_new_NEG_files/figure-markdown_github/unnamed-chunk-37-1.png)

``` r
# Save plot
ggsave(filename = "E:/Paper/Estadistica_multivariable_negativo/volcano_sample.pdf", plot = sp_vc_plot,
       width = 7, height = 8, units = "in", dpi = "print")
```

    ## Warning: Removed 4 rows containing missing values or values outside the scale range
    ## (`geom_label_repel()`).

``` r
ggsave(filename = "E:/Paper/Estadistica_multivariable_negativo/volcano_sample.png", plot = sp_vc_plot,
       width = 7, height = 8, units = "in", dpi = "print")
```

    ## Warning: Removed 4 rows containing missing values or values outside the scale range
    ## (`geom_label_repel()`).

# Tukey

``` r
# Drop QC
tk_no_qc <- drop_qcs(glog_set)
# Drop samples
tk_no_sample <- tk_no_qc[, tk_no_qc$Analysis_group != "Sample"]
pData(tk_no_sample) <- droplevels(pData(tk_no_sample))
# Extracting levels of age factor
tk_age <- tk_no_sample[, tk_no_sample$Age_Factor != "Other factor"]
pData(tk_age) <- droplevels(pData(tk_age))
# Extracting identified metabolites
tk_age_set <- tk_age[!is.na(tk_age@featureData@data$Metabolite),]
```

``` r
# Extracting feature height table
tk_height <- exprs(tk_age_set)
# Extracting sample information
tk_pdata <- tk_age_set@phenoData@data
tk_pdata <- data.frame(Sample_ID = tk_pdata$Sample_ID,
                       Age_factor = tk_pdata$Age_Factor)
# Extracting feature information
tk_fdata <- tk_age_set@featureData@data
tk_fdata <- data.frame(Feature_ID = tk_fdata$Feature_ID,
                       Metabolite = tk_fdata$Metabolite)
# Transposing feature height table
tk_height <- t(tk_height)
# Feature height table to dataframe
tk_height <- as.data.frame(tk_height)
# Convert the row names to sample ID
tk_height <- tk_height %>% 
  mutate(Sample_ID = rownames(tk_height))
# Adding age factor as variable
tk_height <- left_join(tk_pdata, tk_height)
```

    ## Joining with `by = join_by(Sample_ID)`

``` r
# Performing homoscedasticity test
tk_bar_res <-
  perform_homoscedasticity_tests(tk_age_set,
                                 formula_char = "Feature ~ Age_Factor")
```

    ## INFO [2025-04-08 11:24:57] Starting homoscedasticity tests.
    ## INFO [2025-04-08 11:24:57] Homoscedasticity tests performed.

``` r
# Adding a description of the p-value
tk_bar_res <- tk_bar_res %>%
  mutate(bartlett_group = ifelse(Levene_P > 0.05,
                                 "equal variance",
                                 "unequal variance"))
```

``` r
# Create two empty vectors to add results
Feature_ID <- c()
anova_pValue <- c()
# Batch analysis
for(i in 3:9) {
  anova_model <- glm(tk_height[, i] ~ tk_height$Age_factor, data = tk_height)
  anova_res <- anova(anova_model, test = "LRT")
  anova_pValue <- c(anova_pValue, anova_res$`Pr(>Chi)`[2])
  Feature_ID <- c(Feature_ID, names(tk_height[i]))
  tk_anova_res <- data.frame(Feature_ID, anova_pValue)
}
# Adding a description of the p-value
tk_anova_res <- tk_anova_res %>%
  mutate(anova_group = ifelse(anova_pValue > 0.05,
                              "Not Significant",
                              "Significant"))
```

``` r
# agricolae package installation and library loadding
#install.packages("agricolae", repos = "https://cran.r-project.org")
library(agricolae)
# Create two empty vectors to add results
Feature_ID <- c()
tk_group_early <- c()
tk_group_late <- c()
tk_group_medium <- c()
# Batch analysis
for(i in 3:9) {
  tk_model <- aov(tk_height[, i] ~ tk_height$Age_factor, data = tk_height)
  tk_tes <- HSD.test(tk_model, "tk_height$Age_factor", group = TRUE)
  tk_group_early <- c(tk_group_early, tk_tes[["groups"]]["Early",2])
  tk_group_late <- c(tk_group_late, tk_tes[["groups"]]["Late",2])
  tk_group_medium <- c(tk_group_medium, tk_tes[["groups"]]["Medium",2])
  Feature_ID <- c(Feature_ID, names(tk_height[i]))
  tk_res <- data.frame(Feature_ID, tk_group_early, tk_group_late,
                       tk_group_medium)
  tk_res
}
```

``` r
# Merge all results obtained in the Tukey test
tk_result <- left_join(tk_bar_res, tk_anova_res)
```

    ## Joining with `by = join_by(Feature_ID)`

``` r
tk_result <- left_join(tk_result, tk_res)
```

    ## Joining with `by = join_by(Feature_ID)`

``` r
# Flag metabolites
for(i in 1:10) {
  # Flag "-" metabolites that has unequal variance
  if (tk_result$bartlett_group[i] == "unequal variance") {
        tk_result$tk_group_early[i] <- "-"
        tk_result$tk_group_medium[i] <- "-"
        tk_result$tk_group_late[i] <- "-"
  }
  # Flag "ns" metabolites not significant
  if (tk_result$anova_group[i] == "Not Significant" &
      tk_result$bartlett_group[i] == "equal variance") {
        tk_result$tk_group_early[i] <- "ns"
        tk_result$tk_group_medium[i] <- "ns"
        tk_result$tk_group_late[i] <- "ns"
}
 tk_result
}
```

``` r
# Tukey table to heatmap
hm_tk_table <- data.frame(Feature_ID = tk_result$Feature_ID,
                          Early = tk_result$tk_group_early,
                          Late = tk_result$tk_group_late,
                          Medium = tk_result$tk_group_medium)
```

``` r
# The "gt" package installation
#install.packages("gt")
library(gt)
```

    ## 
    ## Adjuntando el paquete: 'gt'

    ## The following object is masked from 'package:Hmisc':
    ## 
    ##     html

``` r
# Adding metabolite name
tk_table <- left_join(tk_fdata, hm_tk_table)
```

    ## Joining with `by = join_by(Feature_ID)`

``` r
# Deleting the Feature_ID column
tk_table <- subset(tk_table, select = -c(Feature_ID) )
tk_table <- tk_table |>
  gt() |>
  fmt_markdown(
  columns = everything(),
  rows = everything(),
  md_engine = c("markdown", "commonmark")) |>
  tab_spanner(
    label = "Tukey test",
    columns = 2:4) |>
    tab_source_note(source_note = "Note: Different lowercase letter within the 
                  same row indicates significant differences based on Tukey's 
                  multiple comparisons (p-value < 0.05, n = 3). '-' represents 
                  features with unequal variance according to Levene's test. 
                  'ns' are the features that do not have statistical 
                  differences (p-value > 0.05) according to the ANOVA test.") |>
  tab_options(table.width = px(750)) |>
  as_raw_html()
tk_table
```

<div id="eagxyzbjgg" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
  
  <table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false" style="-webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'; display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: 750px; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3;" width="750" bgcolor="#FFFFFF">
  <thead style="border-style: none;">
    <tr class="gt_col_headings gt_spanner_row" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; border-bottom-style: hidden;">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="2" colspan="1" scope="col" id="Metabolite" style="border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; text-align: left;" bgcolor="#FFFFFF" valign="bottom" align="left">Metabolite</th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3" scope="colgroup" id="Tukey test" style="border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; text-align: center; padding-right: 0;" bgcolor="#FFFFFF" align="center">
        <div class="gt_column_spanner" style="border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%;">Tukey test</div>
      </th>
    </tr>
    <tr class="gt_col_headings" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3;">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Early" style="border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; text-align: left;" bgcolor="#FFFFFF" valign="bottom" align="left">Early</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Late" style="border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; text-align: left;" bgcolor="#FFFFFF" valign="bottom" align="left">Late</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Medium" style="border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; text-align: left;" bgcolor="#FFFFFF" valign="bottom" align="left">Medium</th>
    </tr>
  </thead>
  <tbody class="gt_table_body" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3;">
    <tr style="border-style: none;"><td headers="Metabolite" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md">Neochlorogenic Acid</span></td>
<td headers="Early" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md">ns</span></td>
<td headers="Late" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md">ns</span></td>
<td headers="Medium" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md">ns</span></td></tr>
    <tr style="border-style: none;"><td headers="Metabolite" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md">Quinic acid</span></td>
<td headers="Early" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md">ns</span></td>
<td headers="Late" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md">ns</span></td>
<td headers="Medium" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md">ns</span></td></tr>
    <tr style="border-style: none;"><td headers="Metabolite" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md">Kaempferol-3-O-glucoside</span></td>
<td headers="Early" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md"><ul style="margin-top: 0; margin-bottom: 0;">
<li></li>
</ul>
</span></td>
<td headers="Late" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md"><ul style="margin-top: 0; margin-bottom: 0;">
<li></li>
</ul>
</span></td>
<td headers="Medium" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md"><ul style="margin-top: 0; margin-bottom: 0;">
<li></li>
</ul>
</span></td></tr>
    <tr style="border-style: none;"><td headers="Metabolite" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md">Hyperoside</span></td>
<td headers="Early" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md"><ul style="margin-top: 0; margin-bottom: 0;">
<li></li>
</ul>
</span></td>
<td headers="Late" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md"><ul style="margin-top: 0; margin-bottom: 0;">
<li></li>
</ul>
</span></td>
<td headers="Medium" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md"><ul style="margin-top: 0; margin-bottom: 0;">
<li></li>
</ul>
</span></td></tr>
    <tr style="border-style: none;"><td headers="Metabolite" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md">Sucrose</span></td>
<td headers="Early" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md">ns</span></td>
<td headers="Late" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md">ns</span></td>
<td headers="Medium" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md">ns</span></td></tr>
    <tr style="border-style: none;"><td headers="Metabolite" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md">Chlorogenoquinone / Chlorogenic Acid</span></td>
<td headers="Early" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md"><ul style="margin-top: 0; margin-bottom: 0;">
<li></li>
</ul>
</span></td>
<td headers="Late" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md"><ul style="margin-top: 0; margin-bottom: 0;">
<li></li>
</ul>
</span></td>
<td headers="Medium" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md"><ul style="margin-top: 0; margin-bottom: 0;">
<li></li>
</ul>
</span></td></tr>
    <tr style="border-style: none;"><td headers="Metabolite" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md">Trehalose</span></td>
<td headers="Early" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md">ns</span></td>
<td headers="Late" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md">ns</span></td>
<td headers="Medium" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md">ns</span></td></tr>
    <tr style="border-style: none;"><td headers="Metabolite" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md">Plantaginin</span></td>
<td headers="Early" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md"><ul style="margin-top: 0; margin-bottom: 0;">
<li></li>
</ul>
</span></td>
<td headers="Late" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md"><ul style="margin-top: 0; margin-bottom: 0;">
<li></li>
</ul>
</span></td>
<td headers="Medium" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md"><ul style="margin-top: 0; margin-bottom: 0;">
<li></li>
</ul>
</span></td></tr>
    <tr style="border-style: none;"><td headers="Metabolite" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md">Keracyanine</span></td>
<td headers="Early" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md"><ul style="margin-top: 0; margin-bottom: 0;">
<li></li>
</ul>
</span></td>
<td headers="Late" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md"><ul style="margin-top: 0; margin-bottom: 0;">
<li></li>
</ul>
</span></td>
<td headers="Medium" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md"><ul style="margin-top: 0; margin-bottom: 0;">
<li></li>
</ul>
</span></td></tr>
    <tr style="border-style: none;"><td headers="Metabolite" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md">Rutin</span></td>
<td headers="Early" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md"><ul style="margin-top: 0; margin-bottom: 0;">
<li></li>
</ul>
</span></td>
<td headers="Late" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md"><ul style="margin-top: 0; margin-bottom: 0;">
<li></li>
</ul>
</span></td>
<td headers="Medium" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left"><span class="gt_from_md"><ul style="margin-top: 0; margin-bottom: 0;">
<li></li>
</ul>
</span></td></tr>
  </tbody>
  <tfoot class="gt_sourcenotes" style="border-style: none; color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3;" bgcolor="#FFFFFF">
    <tr style="border-style: none;">
      <td class="gt_sourcenote" colspan="4" style="border-style: none; font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px;">Note: Different lowercase letter within the 
                  same row indicates significant differences based on Tukey's 
                  multiple comparisons (p-value &lt; 0.05, n = 3). '-' represents 
                  features with unequal variance according to Levene's test. 
                  'ns' are the features that do not have statistical 
                  differences (p-value &gt; 0.05) according to the ANOVA test.</td>
    </tr>
  </tfoot>
  
</table>
</div>

# Tukey Sample´s

``` r
# Drop factor pooled (subQC)
tk_no_subqc <- tk_no_qc[, tk_no_qc$Analysis_group != "Sub_Quality_Control"]
pData(tk_no_subqc) <- droplevels(pData(tk_no_subqc))
# Extracting identified metabolites
tk_no_subqc <- tk_no_subqc[!is.na(tk_no_subqc@featureData@data$Metabolite),]
```

``` r
# Extracting feature height table
tk_spl_height <- exprs(tk_no_subqc)
# Extracting sample information
tk_spl_pdata <- tk_no_subqc@phenoData@data
tk_spl_pdata <- data.frame(Sample_ID = tk_spl_pdata$Sample_ID,
                           Age_factor = tk_spl_pdata$Age_Factor)
# Extracting feature information
tk_spl_fdata <- tk_no_subqc@featureData@data
tk_spl_fdata <- data.frame(Feature_ID = tk_spl_fdata$Feature_ID,
                           Metabolite = tk_spl_fdata$Metabolite)
# Transposing feature height table
tk_spl_height <- t(tk_spl_height)
# Feature height table to dataframe
tk_spl_height <- as.data.frame(tk_spl_height)
# Convert the row names to sample ID
tk_spl_height <- tk_spl_height %>% 
  mutate(Sample_ID = rownames(tk_spl_height))
# Adding age factor as variable
tk_spl_height <- left_join(tk_spl_pdata, tk_spl_height)
```

    ## Joining with `by = join_by(Sample_ID)`

``` r
# Performing homoscedasticity test
tk_spl_bar_res <-
  perform_homoscedasticity_tests(tk_no_subqc,
                                 formula_char = "Feature ~ Age_Factor")
```

    ## INFO [2025-04-08 11:24:58] Starting homoscedasticity tests.
    ## INFO [2025-04-08 11:24:58] Homoscedasticity tests performed.

``` r
# Adding a description of the p-value
tk_spl_bar_res <- tk_spl_bar_res %>%
  mutate(bartlett_group = ifelse(Levene_P > 0.05,
                                 "equal variance",
                                 "unequal variance"))
```

``` r
# Create two empty vectors to add results
Feature_ID <- c()
anova_pValue <- c()
# Batch analysis
for(i in 3:12) {
  anova_model <- glm(tk_spl_height[, i] ~ tk_spl_height$Age_factor,
                     data = tk_spl_height)
  anova_res <- anova(anova_model, test = "LRT")
  anova_pValue <- c(anova_pValue, anova_res$`Pr(>Chi)`[2])
  Feature_ID <- c(Feature_ID, names(tk_spl_height[i]))
  tk_spl_anova_res <- data.frame(Feature_ID, anova_pValue)
}
# Adding a description of the p-value
tk_spl_anova_res <- tk_spl_anova_res %>%
  mutate(anova_group = ifelse(anova_pValue > 0.05,
                              "Not Significant",
                              "Significant"))
```

``` r
# Create two empty vectors to add results
Feature_ID <- c()
tk_group_early <- c()
tk_group_late <- c()
tk_group_medium <- c()
# Batch analysis
for(i in 3:12) {
  tk_model <- aov(tk_spl_height[, i] ~ tk_spl_height$Age_factor,
                  data = tk_spl_height)
  tk_tes <- HSD.test(tk_model, "tk_spl_height$Age_factor", group = TRUE)
  tk_group_early <- c(tk_group_early, tk_tes[["groups"]]["Early",2])
  tk_group_late <- c(tk_group_late, tk_tes[["groups"]]["Late",2])
  tk_group_medium <- c(tk_group_medium, tk_tes[["groups"]]["Medium",2])
  Feature_ID <- c(Feature_ID, names(tk_spl_height[i]))
  tk_spl_res <- data.frame(Feature_ID, tk_group_early, tk_group_late,
                       tk_group_medium)
  tk_spl_res
}
```

``` r
# Merge all results obtained in the Tukey test
tk_spl_result <- left_join(tk_spl_bar_res, tk_spl_anova_res)
```

    ## Joining with `by = join_by(Feature_ID)`

``` r
tk_spl_result <- left_join(tk_spl_result, tk_spl_res)
```

    ## Joining with `by = join_by(Feature_ID)`

``` r
# Flag "-" metabolites that has unequal variance
for(i in 1:10) {
  if (tk_spl_result$bartlett_group[i] == "unequal variance") {
        tk_spl_result$tk_group_early[i] <- "-"
        tk_spl_result$tk_group_medium[i] <- "-"
        tk_spl_result$tk_group_late[i] <- "-"
  }
  if (tk_spl_result$anova_group[i] == "Not Significant" &
      tk_spl_result$bartlett_group[i] == "equal variance") {
        tk_spl_result$tk_group_early[i] <- "ns"
        tk_spl_result$tk_group_medium[i] <- "ns"
        tk_spl_result$tk_group_late[i] <- "ns"
}
 tk_spl_result
}
```

``` r
# Tukey table to heatmap
hm_tk_table_spl <- data.frame(Feature_ID = tk_spl_result$Feature_ID,
                          Early = tk_spl_result$tk_group_early,
                          Late = tk_spl_result$tk_group_late,
                          Medium = tk_spl_result$tk_group_medium)
```

``` r
# Adding metabolite name
tk_table_spl <- left_join(tk_fdata, hm_tk_table_spl)
```

    ## Joining with `by = join_by(Feature_ID)`

``` r
# Deleting the Feature_ID column
tk_table_spl <- subset(tk_table_spl, select = -c(Feature_ID) )
tk_table_spl <- tk_table_spl |>
  gt() |>
  tab_spanner(
    label = "Tukey test",
    columns = 2:4) |>
    tab_source_note(source_note = "Note: Different lowercase letter within the 
                  same row indicates significant differences based on Tukey's 
                  multiple comparisons (p-value < 0.05, n = 18). '-' represents 
                  features with unequal variance according to Levene's test. 
                  'ns' are the features that do not have statistical 
                  differences (p-value > 0.05) according to the ANOVA test.") |>
  tab_options(table.width = px(750)) |>
  as_raw_html()
tk_table_spl
```

<div id="eziuhfktrg" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
  
  <table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false" style="-webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'; display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: 750px; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3;" width="750" bgcolor="#FFFFFF">
  <thead style="border-style: none;">
    <tr class="gt_col_headings gt_spanner_row" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; border-bottom-style: hidden;">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="2" colspan="1" scope="col" id="Metabolite" style="border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; text-align: left;" bgcolor="#FFFFFF" valign="bottom" align="left">Metabolite</th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3" scope="colgroup" id="Tukey test" style="border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; text-align: center; padding-right: 0;" bgcolor="#FFFFFF" align="center">
        <div class="gt_column_spanner" style="border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%;">Tukey test</div>
      </th>
    </tr>
    <tr class="gt_col_headings" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3;">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Early" style="border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; text-align: left;" bgcolor="#FFFFFF" valign="bottom" align="left">Early</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Late" style="border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; text-align: left;" bgcolor="#FFFFFF" valign="bottom" align="left">Late</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Medium" style="border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; text-align: left;" bgcolor="#FFFFFF" valign="bottom" align="left">Medium</th>
    </tr>
  </thead>
  <tbody class="gt_table_body" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3;">
    <tr style="border-style: none;"><td headers="Metabolite" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">Neochlorogenic Acid</td>
<td headers="Early" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">-</td>
<td headers="Late" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">-</td>
<td headers="Medium" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">-</td></tr>
    <tr style="border-style: none;"><td headers="Metabolite" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">Quinic acid</td>
<td headers="Early" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">a</td>
<td headers="Late" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">b</td>
<td headers="Medium" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">ab</td></tr>
    <tr style="border-style: none;"><td headers="Metabolite" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">Kaempferol-3-O-glucoside</td>
<td headers="Early" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">a</td>
<td headers="Late" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">b</td>
<td headers="Medium" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">b</td></tr>
    <tr style="border-style: none;"><td headers="Metabolite" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">Hyperoside</td>
<td headers="Early" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">a</td>
<td headers="Late" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">b</td>
<td headers="Medium" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">b</td></tr>
    <tr style="border-style: none;"><td headers="Metabolite" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">Sucrose</td>
<td headers="Early" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">ab</td>
<td headers="Late" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">b</td>
<td headers="Medium" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">a</td></tr>
    <tr style="border-style: none;"><td headers="Metabolite" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">Chlorogenoquinone / Chlorogenic Acid</td>
<td headers="Early" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">-</td>
<td headers="Late" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">-</td>
<td headers="Medium" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">-</td></tr>
    <tr style="border-style: none;"><td headers="Metabolite" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">Trehalose</td>
<td headers="Early" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">ns</td>
<td headers="Late" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">ns</td>
<td headers="Medium" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">ns</td></tr>
    <tr style="border-style: none;"><td headers="Metabolite" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">Plantaginin</td>
<td headers="Early" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">a</td>
<td headers="Late" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">b</td>
<td headers="Medium" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">b</td></tr>
    <tr style="border-style: none;"><td headers="Metabolite" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">Keracyanine</td>
<td headers="Early" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">-</td>
<td headers="Late" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">-</td>
<td headers="Medium" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">-</td></tr>
    <tr style="border-style: none;"><td headers="Metabolite" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">Rutin</td>
<td headers="Early" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">a</td>
<td headers="Late" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">a</td>
<td headers="Medium" class="gt_row gt_left" style="border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; text-align: left;" valign="middle" align="left">a</td></tr>
  </tbody>
  <tfoot class="gt_sourcenotes" style="border-style: none; color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3;" bgcolor="#FFFFFF">
    <tr style="border-style: none;">
      <td class="gt_sourcenote" colspan="4" style="border-style: none; font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px;">Note: Different lowercase letter within the 
                  same row indicates significant differences based on Tukey's 
                  multiple comparisons (p-value &lt; 0.05, n = 18). '-' represents 
                  features with unequal variance according to Levene's test. 
                  'ns' are the features that do not have statistical 
                  differences (p-value &gt; 0.05) according to the ANOVA test.</td>
    </tr>
  </tfoot>
  
</table>
</div>

# PCA

``` r
# Extracting feature height table
pca_peakheight <- exprs(glog_set)
# Extracting Phenotipic data
pca_phenodata <- glog_set@phenoData@data
```

``` r
# Transposing feature height table
transp_table  <- t(pca_peakheight)
# Centering features
ei_pca <- prcomp(transp_table, center = TRUE, scale. = FALSE)
```

``` r
# Extract clean data
no_flag <- drop_flagged(pqn_set)
# Extracting feature height table
peak_height <- exprs(no_flag)
# Extracting Phenotipic data
pheno_data <- no_flag@phenoData@data

# Library to left_join use
library(dplyr)
# PCA scores
scores <- ei_pca$x %>%                   # Get PC coordinates
  data.frame %>%                         # Convert to data frames
  mutate(Sample_ID = rownames(.)) %>%    # Create a new column with the sample names
  left_join(pheno_data )                 # Adding metadata
```

    ## Joining with `by = join_by(Sample_ID)`

``` r
#Colors

custom_colors <- c(
  "Light conditions-Light" = "#F5BC5CFF",
  "Location-Alto Pano" = "#B24422FF",
  "Location-Alto Tena" = "#4F9D4EFF",
  "Location-Talag" = "#4457A5FF",
  "Period age-Early" = "#E76BF3",
  "Period age-Late" = "#F8766D",
  "Period age-Medium" = "#00B0F6",
  "QC" = "#00BFC4",
  "Sample" = "#D3D9D9FF",
  "Shade conditions-Shade" = "#32373AFF"
)

custom_shapes <- c(
  "Light conditions" = 16, # Círculo lleno
  "Location" = 17,         # Triángulo lleno
  "Period age" = 15,       # Cuadrado lleno
  "QC" = 3,                # Cruz
  "Sample" = 1,            # Círculo vacio
  "Shade conditions" = 16   # Círculo lleno
)

# PCA plot
ggplot(scores,
       aes(PC1, PC2, shape = `Factor`, color = `Group`)) +
  geom_point(size = 3) +
  guides(x=guide_axis(title = "PC1 (24.57 %)"),
         y=guide_axis(title = "PC2 (18.04 %)")) +
#  geom_text(label=pheno_data$Sample_ID,
#            nudge_x = 1,
#            nudge_y = 1,
#            show.legend = FALSE) +
  theme_classic() +
#  theme(legend.text = element_text(face="italic")) +
#  theme(legend.position = c(0.07, 0.1),
#        legend.background = element_rect(fill = "white", color = "black")) +
#  theme(panel.grid = element_blank(), 
#        panel.border = element_rect(fill= "transparent")) +
  geom_vline(xintercept = 0, linetype = "longdash", colour="gray") +
  geom_hline(yintercept = 0, linetype = "longdash", colour="gray") +
  scale_color_manual(values = custom_colors) +
  scale_shape_manual(values = custom_shapes)
```

![](Multivariate_Statistics_new_NEG_files/figure-markdown_github/unnamed-chunk-63-1.png)

``` r
# Save plot
#ggsave("E:/Paper/Estadistica_multivariable_negativo/PCA_general.pdf", width = 8, height = 6, units = "in", dpi = "print")
#ggsave("E:/Paper/Estadistica_multivariable_negativo/PCA_general.png", width = 8, height = 6, units = "in", dpi = "print")
```

# Light factor PCA

``` r
# PCA scores
scores <- ei_pca$x %>%                   # Get PC coordinates
  data.frame %>%                         # Convert to data frames
  mutate(Sample_ID = rownames(.)) %>%    # Create a new column with the sample names
  left_join(pca_phenodata)               # Adding metadata
```

    ## Joining with `by = join_by(Sample_ID)`

``` r
# Change the order of legend column of DataFrame
scores$Light_Factor <- factor(scores$Light_Factor,
                              levels = c("Light",
                                         "Shade",
                                         "Other enviroment factors",
                                         "QC"))
scores$Analysis_group <- factor(scores$Analysis_group,
                                levels = c("Sample",
                                           "Sub_Quality_Control",
                                           "QC"),
                                labels=c("Sample",
                                         "SubQC",
                                         "QC"))
# PCA plot
figure_1a <- ggplot(scores,
                     aes(PC1, PC2, shape = Analysis_group,
                         color = Light_Factor)) +
  scale_color_manual(values=c("#F5BC5CFF",
                              "#32373AFF",
                              "#D3D9D9FF",
                              "#00BFC4")) +
  scale_shape_manual(values=c(1, 17, 15)) +
  geom_point(size = 3) +
  guides(x=guide_axis(title = "PC1 (18.35 %)"),
         y=guide_axis(title = "PC2 (15.20 %)"),
         shape = guide_legend(order = 2),
         color = guide_legend(order = 1)) +
  labs(shape = 'Analysis group', color= 'Light factor') +
  theme_classic() +
#  theme(legend.position = c(0.88, 0.80),
#        legend.background = element_rect(fill = "white", color = "black")) +
  theme(panel.grid = element_blank(),
        panel.border = element_rect(fill= "transparent")) +
  geom_vline(xintercept = 0, linetype = "longdash", colour="gray") +
  geom_hline(yintercept = 0, linetype = "longdash", colour="gray")
figure_1a
```

![](Multivariate_Statistics_new_NEG_files/figure-markdown_github/unnamed-chunk-64-1.png)

``` r
# Save plot
#ggsave("E:/Paper/Estadistica_multivariable_negativo/PCA_light_factor.pdf", width = 8, height = 6, units = "in", dpi = "print")
#ggsave("E:/Paper/Estadistica_multivariable_negativo/PCA_light_factor.png", width = 8, height = 6, units = "in", dpi = "print")
```

# Age factor PCA

``` r
# PCA scores
scores <- ei_pca$x %>%                   # Get PC coordinates
  data.frame %>%                         # Convert to data frames
  mutate(Sample_ID = rownames(.)) %>%    # Create a new column with the sample names
  left_join(pca_phenodata)               # Adding metadata
```

    ## Joining with `by = join_by(Sample_ID)`

``` r
# Change the order of legend column of DataFrame
scores$Age_Factor <- factor(scores$Age_Factor,
                 levels = c("Early",
                            "Medium",
                            "Late",
                            "Other enviroment factors",
                            "QC"))
scores$Analysis_group <- factor(scores$Analysis_group,
                 levels = c("Sample",
                            "Sub_Quality_Control",
                            "QC"),
                 labels=c("Sample",
                          "SubQC",
                          "QC"))
# PCA plot
figure_1b <- ggplot(scores,
                     aes(PC1, PC2, shape = Analysis_group,
                         color = Age_Factor)) +
  scale_color_manual(values=c("#E76BF3",
                              "#00B0F6",
                              "#F8766D",
                              "#D3D9D9FF",
                              "#00BFC4")) +
  scale_shape_manual(values=c(1, 17, 15)) + 
  geom_point(size = 3) +
  guides(x=guide_axis(title = "PC1 (18.35 %)"),
         y=guide_axis(title = "PC2 (15.20 %)"),
         shape = guide_legend(order = 2),
         color = guide_legend(order = 1)) +
  labs(shape = 'Analysis group', color= 'Age Factor') +
  theme_classic() +
#  theme(legend.position = c(0.88, 0.77),
#        legend.background = element_rect(fill = "white", color = "black")) +
  theme(panel.grid = element_blank(),
        panel.border = element_rect(fill= "transparent")) +
  geom_vline(xintercept = 0, linetype = "longdash", colour="gray") +
  geom_hline(yintercept = 0, linetype = "longdash", colour="gray")
figure_1b
```

![](Multivariate_Statistics_new_NEG_files/figure-markdown_github/unnamed-chunk-65-1.png)

``` r
# Save Plot
#ggsave("E:/Paper/Estadistica_multivariable_negativo/PCA_Age_factor.pdf", width = 8, height = 6, units = "in", dpi = "print")
#ggsave("E:/Paper/Estadistica_multivariable_negativo/PCA_Age_factor.png", width = 8, height = 6, units = "in", dpi = "print")
```

# Location factor PCA

``` r
# PCA scores
scores <- ei_pca$x %>%                   # Get PC coordinates
  data.frame %>%                         # Convert to data frames
  mutate(Sample_ID = rownames(.)) %>%    # Create a new column with the sample names
  left_join(pca_phenodata)               # Adding metadata
```

    ## Joining with `by = join_by(Sample_ID)`

``` r
# Change the order of legend column of DataFrame
scores$Location_Factor <- factor(scores$Location_Factor,
                 levels = c("Alto Pano",
                            "Alto Tena",
                            "Talag",
                            "Other enviroment factors",
                            "QC"))
scores$Analysis_group <- factor(scores$Analysis_group,
                 levels = c("Sample",
                            "Sub_Quality_Control",
                            "QC"),
                 labels=c("Sample",
                          "SubQC",
                          "QC"))
# PCA plot
figure_1c <- ggplot(scores,
                     aes(PC1, PC2, shape = Analysis_group,
                         color = Location_Factor)) +
  scale_color_manual(values=c("#B24422FF",
                              "#4F9D4EFF",
                              "#4457A5FF",
                              "#D3D9D9FF",
                              "#00BFC4")) +
  scale_shape_manual(values=c(1, 17, 15)) + 
  geom_point(size = 3) +
  guides(x=guide_axis(title = "PC1 (18.35 %)"),
         y=guide_axis(title = "PC2 (15.20 %)")) +
  labs(shape = 'Analysis group', color= 'Location Factor') +
  theme_classic() +
#  theme(legend.position = c(0.88, 0.77),
#        legend.background = element_rect(fill = "white", color = "black")) +
  theme(panel.grid = element_blank(),
        panel.border = element_rect(fill= "transparent")) +
  geom_vline(xintercept = 0, linetype = "longdash", colour="gray") +
  geom_hline(yintercept = 0, linetype = "longdash", colour="gray")
figure_1c
```

![](Multivariate_Statistics_new_NEG_files/figure-markdown_github/unnamed-chunk-66-1.png)

``` r
# Save Plot
#ggsave("E:/Paper/Estadistica_multivariable_negativo/PCA_Location_factor.pdf", width = 8, height = 6, units = "in", dpi = "print")
#ggsave("E:/Paper/Estadistica_multivariable_negativo/PCA_Location_factor.png", width = 8, height = 6, units = "in", dpi = "print")
```

``` r
# Save plot
#ggsave('Result/notame_Result/Figure_1c.pdf',
#       width = 5, height = 4, device='pdf', dpi="print")
```

# Plotting a loading PCA result.

``` r
loadings <- ei_pca$rotation %>%           # Extract loadings
  data.frame(Feature_ID = rownames(.))    # New column with feat name
```

``` r
# Creating a new small table with the annotated compounds
ei_compouds <- left_join(meta_table, loadings)
```

    ## Joining with `by = join_by(Feature_ID)`

``` r
# Plotting results
figure_1d <- ggplot(loadings, aes(PC1, PC2)) +
  geom_point(alpha = 0.2) +
  theme_classic() + 
  geom_point(data = ei_compouds,
             aes(shape = meta_table$Identification_level,
                 color = meta_table$Identification_level),
             size = 2) +
  labs(shape = 'Identification level',
       color = 'Identification level') +
  ggrepel::geom_label_repel(data = ei_compouds,
                            aes(label = meta_table$Metabolite),
                            box.padding = 0.22,
                            label.padding = 0.22,
                            label.r = 0.3,
                            cex = 2.5,
                            max.overlaps = 7,
                            min.segment.length = 0) +
  guides(x=guide_axis(title = "PC1 (18.35 %)"),
         y=guide_axis(title = "PC2 (15.20 %)")) +
  theme(legend.position = c(0.905, 0.903),
        legend.background = element_rect(fill = "white", color = "black")) +
  theme(panel.grid = element_blank(), 
        panel.border = element_rect(fill= "transparent")) +
  geom_vline(xintercept = 0, linetype = "longdash", colour="gray") +
  geom_hline(yintercept = 0, linetype = "longdash", colour="gray") +
  ggsci::scale_color_aaas()
figure_1d
```

![](Multivariate_Statistics_new_NEG_files/figure-markdown_github/unnamed-chunk-69-1.png)

``` r
# Save plot
#ggsave("E:/Paper/Estadistica_multivariable_negativo/loading_general.pdf", width = 8, height = 6, units = "in", dpi = "print")
#ggsave("E:/Paper/Estadistica_multivariable_negativo/loading_general.png", width = 8, height = 6, units = "in", dpi = "print")
```

# Alto Pano location PCA

Extracting the Alto Pano location data.

``` r
# Drop factor pooled (subQC)
no_subqc <- glog_set[, glog_set$Analysis_group != "Sub_Quality_Control"]
pData(no_subqc) <- droplevels(pData(no_subqc))
# Extracting "Alto Pano" (B) data
b_data <- no_subqc[, no_subqc$Location_Factor != "Alto Tena"]
pData(b_data) <- droplevels(pData(b_data))
b_data <- b_data[, b_data$Location_Factor != "Talag"]
pData(b_data) <- droplevels(pData(b_data))
# Extracting feature height table
b_peakheight <- exprs(b_data)
# Extracting Phenotipic data
b_phenodata <- b_data@phenoData@data
```

Transposing feature table and preparing the PCA data.

``` r
# Transposing feature height table
b_transp_table  <- t(b_peakheight)
# Centering and Scaling features
b_pca <- prcomp(b_transp_table, center = TRUE, scale. = FALSE)
```

Plotting the Alto Pano PCA result.

``` r
# PCA scores
b_scores <- b_pca$x %>%                  # Get PC coordinates
  data.frame %>%                         # Convert to data frames
  mutate(Sample_ID = rownames(.)) %>%    # Create a new column with the sample names
  left_join(b_phenodata)                 # Adding metadata
```

    ## Joining with `by = join_by(Sample_ID)`

``` r
# Change the order of legend column of DataFrame
b_scores$Age_Factor <- factor(b_scores$Age_Factor,
                              levels = c("Early",
                                         "Medium",
                                         "Late",
                                         "QC"))
b_scores$Light_Factor <- factor(b_scores$Light_Factor,
                                levels = c("Light",
                                           "Shade",
                                           "QC"))
# PCA plot
figure_s1a <- ggplot(b_scores,
                     aes(PC1, PC2, shape = Age_Factor,
                         color = Light_Factor)) +
  geom_point(size = 3) +
  guides(x=guide_axis(title = "PC1 (32.40 %)"),
         y=guide_axis(title = "PC2 (21.22 %)")) +
  scale_color_manual(values=c("#F5BC5CFF",
                              "#32373AFF",
                              "#00BFC4")) +
  scale_shape_manual(values=c(16, 17, 15, 8)) + 
  labs(shape = 'Age Factor',
       color='Light Factor') +
  theme_classic() +
#  theme(legend.position = c(0.90, 0.65),
#        legend.background = element_rect(fill = "white", color = "black")) +
  theme(panel.grid = element_blank(), 
        panel.border = element_rect(fill= "transparent")) +
  geom_vline(xintercept = 0, linetype = "longdash", colour="gray") +
  geom_hline(yintercept = 0, linetype = "longdash", colour="gray")
figure_s1a
```

![](Multivariate_Statistics_new_NEG_files/figure-markdown_github/unnamed-chunk-73-1.png)

``` r
# Save plot
ggsave("E:/Paper/Estadistica_multivariable_negativo/PCA_Location_alto_pano.pdf", width = 8, height = 6, units = "in", dpi = "print")
ggsave("E:/Paper/Estadistica_multivariable_negativo/PCA_Location_alto_pano.png", width = 8, height = 6, units = "in", dpi = "print")
```

Plotting the Alto Pano loading PCA result.

``` r
b_loadings <- b_pca$rotation %>%          # Extract loadings
  data.frame(Feature_ID = rownames(.))    # New column with feat name
```

Creating an artificial table with feature names and a compound column
(with identified metabolites).

``` r
# Creating a new small table with the annotated compounds
b_compouds <- left_join(meta_table, b_loadings)
```

    ## Joining with `by = join_by(Feature_ID)`

``` r
# Plotting results
figure_s1d <- ggplot(b_loadings, aes(PC1, PC2)) +
  geom_point(alpha = 0.2) +
  theme_classic() + 
  geom_point(data = b_compouds,
             aes(shape = meta_table$Identification_level,
                 color = meta_table$Identification_level),
             size = 2) +
  labs(shape = 'Identification level',
       color = 'Identification level') +
  ggrepel::geom_label_repel(data = b_compouds,
                            aes(label = meta_table$Metabolite),
                            box.padding = 0.37,
                            label.padding = 0.22,
                            label.r = 0.30,
                            cex = 2.5,
                            max.overlaps = 7) +
  guides(x=guide_axis(title = "PC1 (32.40 %)"),
         y=guide_axis(title = "PC2 (21.22 %)")) +
  theme(legend.position = c(0.905, 0.903),
        legend.background = element_rect(fill = "white", color = "black")) +
  theme(panel.grid = element_blank(), 
        panel.border = element_rect(fill= "transparent")) +
  geom_vline(xintercept = 0, linetype = "longdash", colour="gray") +
  geom_hline(yintercept = 0, linetype = "longdash", colour="gray") +
  ggsci::scale_color_aaas()
figure_s1d
```

![](Multivariate_Statistics_new_NEG_files/figure-markdown_github/unnamed-chunk-76-1.png)

``` r
# Save plot
#ggsave("E:/Paper/Estadistica_multivariable_negativo/Loading_Location_alto_pano#.pdf", width = 8, height = 6, units = "in", dpi = "print")
#ggsave("E:/Paper/Estadistica_multivariable_negativo/Loading_Location_alto_pano.png", width = 8, height = 6, units = "in", dpi = "print")
```

# Alto Tena location PCA

Extracting the Alto Tena location data.

``` r
# Extracting "Alto Tena" (C) data
c_data <- no_subqc[, no_subqc$Location_Factor != "Alto Pano"]
pData(c_data) <- droplevels(pData(c_data))
c_data <- c_data[, c_data$Location_Factor != "Talag"]
pData(c_data) <- droplevels(pData(c_data))
# Extracting feature height table
c_peakheight <- exprs(c_data )
# Extracting Phenotipic data
c_phenodata <- c_data@phenoData@data
```

Transposing feature table and preparing the PCA data.

``` r
# Transposing feature height table
c_transptable  <- t(c_peakheight)
# Centering and Scaling features
c_pca <- prcomp(c_transptable, center = TRUE, scale. = FALSE)
```

Plotting the Alto Tena PCA result.

``` r
# PCA scores
c_scores <- c_pca$x %>%                  # Get PC coordinates
  data.frame %>%                         # Convert to data frames
  mutate(Sample_ID = rownames(.)) %>%    # Create a new column with the sample names
  left_join(c_phenodata)                 # Adding metadata
```

    ## Joining with `by = join_by(Sample_ID)`

``` r
# Change the order of legend column of DataFrame
c_scores$Age_Factor <- factor(c_scores$Age_Factor,
                              levels = c("Early",
                                         "Medium",
                                         "Late",
                                         "QC"))
c_scores$Light_Factor <- factor(c_scores$Light_Factor,
                                levels = c("Light",
                                           "Shade",
                                           "QC"))
# PCA plot
figure_s1b <- ggplot(c_scores,
                    aes(PC1, PC2, shape = Age_Factor,
                        color = Light_Factor)) +
  geom_point(size = 3) +
  guides(x=guide_axis(title = "PC1 (24.53 %)"),
         y=guide_axis(title = "PC2 (16.96 %)")) +
  scale_color_manual(values=c("#F5BC5CFF",
                              "#32373AFF",
                              "#00BFC4")) +
  scale_shape_manual(values=c(16, 17, 15, 8)) + 
  labs(shape = 'Age Factor',
       color = 'Light Factor') +
  theme_classic() +
#  theme(legend.position = c(0.08, 0.65),
#        legend.background = element_rect(fill = "white", color = "black")) +
  theme(panel.grid = element_blank(), 
        panel.border = element_rect(fill= "transparent")) +
  geom_vline(xintercept = 0, linetype = "longdash", colour="gray") +
  geom_hline(yintercept = 0, linetype = "longdash", colour="gray")
figure_s1b
```

![](Multivariate_Statistics_new_NEG_files/figure-markdown_github/unnamed-chunk-80-1.png)

``` r
# Save plot
#ggsave("E:/Paper/Estadistica_multivariable_negativo/PCA_Location_alto_tena.pdf", width = 8, height = 6, units = "in", dpi = "print")
#ggsave("E:/Paper/Estadistica_multivariable_negativo/PCA_Location_alto_tena.png", width = 8, height = 6, units = "in", dpi = "print")
```

Plotting the Alto Tena loading PCA result.

``` r
c_loadings <- c_pca$rotation %>%          # Extract loadings
  data.frame(Feature_ID = rownames(.))    # New column with feat name
```

Creating an artificial table with feature names and a compound column
(with identified metabolites).

``` r
# Creating a new small table of the annotated compounds
c_compouds <- left_join(meta_table, c_loadings)
```

    ## Joining with `by = join_by(Feature_ID)`

``` r
# Plotting results
figure_s1e <- ggplot(c_loadings, aes(PC1, PC2)) +
  geom_point(alpha = 0.2) +
  theme_classic() + 
  geom_point(data = c_compouds,
             aes(shape = meta_table$Identification_level,
                 color = meta_table$Identification_level),
             size = 2) +
  labs(shape = 'Identification level',
       color = 'Identification level') +
  ggrepel::geom_label_repel(data = c_compouds,
                            aes(label = meta_table$Metabolite),
                            box.padding = 0.37,
                            label.padding = 0.22,
                            label.r = 0.30,
                            cex = 2.5,
                            max.overlaps = 7) +
  guides(x=guide_axis(title = "PC1 (24.53 %)"),
         y=guide_axis(title = "PC2 (16.96 %)")) +
  theme(legend.position = c(0.905, 0.903),
        legend.background = element_rect(fill = "white", color = "black")) +
  theme(panel.grid = element_blank(), 
        panel.border = element_rect(fill= "transparent")) +
  geom_vline(xintercept = 0, linetype = "longdash", colour="gray") +
  geom_hline(yintercept = 0, linetype = "longdash", colour="gray") +
  ggsci::scale_color_aaas()
figure_s1e
```

![](Multivariate_Statistics_new_NEG_files/figure-markdown_github/unnamed-chunk-83-1.png)

``` r
# Save plot
#ggsave("E:/Paper/Estadistica_multivariable_negativo/Loading_Location_alto_Tena.pdf", width = 8, height = 6, units = "in", dpi = "print")
#ggsave("E:/Paper/Estadistica_multivariable_negativo/Loading_Location_alto_Tena.png", width = 8, height = 6, units = "in", dpi = "print")
```

# Talag location PCA

Extracting the Talag location data.

``` r
# Extracting "Talag" (A) data
a_data <- no_subqc[, no_subqc$Location_Factor != "Alto Pano"]
pData(a_data) <- droplevels(pData(a_data))
a_data <- a_data[, a_data$Location_Factor != "Alto Tena"]
pData(a_data) <- droplevels(pData(a_data))
# Extracting feature height table
a_peakheight <- exprs(a_data )
# Extracting Phenotipic data
a_phenodata <- a_data@phenoData@data
```

Transposing feature table and preparing the PCA data.

``` r
# Transposing feature height table
a_transptable  <- t(a_peakheight)
# Centering and Scaling features
a_pca <- prcomp(a_transptable, center = TRUE, scale. = FALSE)
```

Plotting the Talag PCA result.

``` r
# PCA scores
a_scores <- a_pca$x %>%                 # Get PC coordinates
  data.frame %>%                        # Convert to data frames
  mutate(Sample_ID = rownames(.)) %>%   # Create a new column with the sample names
  left_join(a_phenodata)                # Adding metadata
```

    ## Joining with `by = join_by(Sample_ID)`

``` r
# Change the order of legend column of DataFrame
a_scores$Age_Factor <- factor(a_scores$Age_Factor,
                              levels = c("Early",
                                         "Medium",
                                         "Late",
                                         "QC"))
a_scores$Light_Factor <- factor(a_scores$Light_Factor,
                               levels = c("Light",
                                          "Shade",
                                          "QC"))
# PCA plot
figure_s1c <- ggplot(a_scores,
                    aes(PC1, PC2, shape = Age_Factor,
                        color = Light_Factor)) +
  geom_point(size = 3) +
  guides(x=guide_axis(title = "PC1 (31.23 %)"),
         y=guide_axis(title = "PC2 (21.11 %)")) +
  scale_color_manual(values=c("#F5BC5CFF",
                              "#32373AFF",
                              "#00BFC4")) +
  scale_shape_manual(values=c(16, 17, 15, 8)) + 
  labs(shape = 'Age Factor',
       color = 'Light Factor') +
  theme_classic() +
#  theme(legend.position = c(1.08, 0.65),
#        legend.background = element_rect(fill = "white", color = "black")) +
  theme(panel.grid = element_blank(), 
        panel.border = element_rect(fill= "transparent")) +
  geom_vline(xintercept = 0, linetype = "longdash", colour="gray") +
  geom_hline(yintercept = 0, linetype = "longdash", colour="gray")
figure_s1c
```

![](Multivariate_Statistics_new_NEG_files/figure-markdown_github/unnamed-chunk-87-1.png)

``` r
# Save plot
#ggsave("E:/Paper/Estadistica_multivariable_negativo/PCA_Location_Talag.pdf", width = 8, height = 6, units = "in", dpi = "print")
#ggsave("E:/Paper/Estadistica_multivariable_negativo/PCA_Location_Talag.png", width = 8, height = 6, units = "in", dpi = "print")
```

Plotting the Talag loading PCA result.

``` r
a_loadings <- a_pca$rotation %>%          # Extract loadings
  data.frame(Feature_ID = rownames(.))    # New column with feat name
```

Creating an artificial table with feature names and a compound column
(with identified metabolites).

``` r
# Creating a new small table of the annotated compounds
a_compouds <- left_join(meta_table, a_loadings)
```

    ## Joining with `by = join_by(Feature_ID)`

``` r
# Plotting results
figure_s1f <- ggplot(a_loadings, aes(PC1, PC2)) +
  geom_point(alpha = 0.2) +
  theme_classic() + 
  geom_point(data = a_compouds,
             aes(shape = meta_table$Identification_level,
                 color = meta_table$Identification_level),
             size = 2) +
  labs(shape = 'Identification level',
       color = 'Identification level') +
  ggrepel::geom_label_repel(data = a_compouds,
                            aes(label = meta_table$Metabolite),
                            box.padding = 0.37,
                            label.padding = 0.22,
                            label.r = 0.30,
                            cex = 2.5,
                            max.overlaps = 7) +
  guides(x=guide_axis(title = "PC1 (31.23 %)"),
         y=guide_axis(title = "PC2 (21.11 %)")) +
  theme(legend.position = c(0.905, 0.903),
        legend.background = element_rect(fill = "white", color = "black")) +
  theme(panel.grid = element_blank(), 
        panel.border = element_rect(fill= "transparent")) +
  geom_vline(xintercept = 0, linetype = "longdash", colour="gray") +
  geom_hline(yintercept = 0, linetype = "longdash", colour="gray") +
  ggsci::scale_color_aaas()
figure_s1f
```

![](Multivariate_Statistics_new_NEG_files/figure-markdown_github/unnamed-chunk-90-1.png)

``` r
# Save plot
#ggsave("E:/Paper/Estadistica_multivariable_negativo/Loading_Location_Talag.pdf", width = 8, height = 6, units = "in", dpi = "print")
#ggsave("E:/Paper/Estadistica_multivariable_negativo/Loading_Location_Talag.png", width = 8, height = 6, units = "in", dpi = "print")
```

# Heatmap and HCA

ComplexHeatmap package and dependency installation.

``` r
# ComplexHeatmap package installation
#if (!requireNamespace("BiocManager", quietly=TRUE))
#    install.packages("BiocManager")
#BiocManager::install("ComplexHeatmap")
library(ComplexHeatmap)

# ColorRamp2 package installation
#if (!requireNamespace("devtools", quietly = TRUE)) {
#  install.packages("devtools")
#}
#devtools::install_github("jokergoo/colorRamp2")
library(colorRamp2)

# Cowplot package installation
#install.packages("cowplot")
library(cowplot)

#"notame" output to find and filter height of identified metabolites

#write_to_excel(compressed, "E:/Paper/results/LC-MS-cluster/QC_N_compres.xlsx")
```

# Heatmap and HCA of age

Scaling glog data by auto-Scaling method and age factor data extraction.

``` r
# Scaling by autoscaling method
# Scaling by autoscaling method
hm_scl <- scale(t(glog_exprs), center = TRUE, scale = TRUE)
hm_scl <- t(hm_scl)
# Adding autoscaling data to notame MetaboSet
hm_scl_set <- ppm_noflag
exprs(hm_scl_set) <- hm_scl
# Drop QC
hm_no_qc <- drop_qcs(hm_scl_set)
# Drop samples
hm_no_sample <- hm_no_qc[, hm_no_qc$Analysis_group != "Sample"]
pData(hm_no_sample) <- droplevels(pData(hm_no_sample))
# Extracting levels of age factor
hm_age <- hm_no_sample[, hm_no_sample$Age_Factor != "Other enviroment factors"]
pData(hm_age) <- droplevels(pData(hm_age))
# Extracting identified metabolites
hm_age_set <- hm_age[!is.na(hm_age@featureData@data$Metabolite),]
```

We improve heatmap visualization by adding the Tukey test as row
annotation. The Tukey test calculation code is available in this
notebook’s Univariate statistic section.

``` r
# Adding tukey test result
hm_age_set <- join_fData(hm_age_set, hm_tk_table)
```

Row and top heatmap annotation.

``` r
set.seed(2571)
# Extracting feature height table
hm_height <- exprs(hm_age_set)
# Extracting sample information
hm_pdata <- hm_age_set@phenoData@data
# Extracting feature information
hm_fdata <- hm_age_set@featureData@data
# Adding row and column name
rownames(hm_height) <- hm_fdata$Metabolite
colnames(hm_height) <- hm_pdata$Group
# Metabolite superclass color
cols_metclass <- c("Organic oxygen compounds" = "#C8876EFF",
                   "Phenylpropanoids and polyketides" = "#F3C571FF")
# Add row anotation to HeatMap
hm_row_ann <- rowAnnotation(`Superclass` = hm_fdata$Superclass,
                            #`Tukey test 2` = anno_text(hm_fdata$Late,
                                                       #location = 0.5,
                                                       #just = "center",
                                                       #gp = gpar(fill = "#F8766D",
                                                          #       col = "#666666"),
                                                       #show_name = TRUE),
                            #`Tukey test 1` = anno_text(hm_fdata$Medium,
                                                       #location = 0.5,
                                                       #just = "center",
                                                       #gp = gpar(fill = "#00B0F6",
                                                          #       col = "#666666"),
                                                       #show_name = TRUE),
                            #`Tukey test 0` = anno_text(hm_fdata$Early,
                                                       #location = 0.5,
                                                       #just = "center",
                                                       #gp = gpar(fill = "#E76BF3",
                                                        #         col = "#666666"),
                                                       #show_name = TRUE),
                            col = list(`Superclass` = cols_metclass),
                            show_annotation_name = T,
                            show_legend = F)
# Factor levels color
cols_levels <- c("Shade conditions-Shade" = "#32373AFF",
                 "Period age-Early" = "#E76BF3",
                 "Light conditions-Light" = "#F5BC5CFF",
                 "Period age-Late" = "#F8766D",
                 "Location-Talag" = "#4457A5FF",
                 "Period age-Medium" = "#00B0F6",
                 "Location-Alto Tena" = "#4F9D4EFF",
                 "Location-Alto Pano" = "#B24422FF")
cols_light <- c("Light" = "#F5BC5CFF",
                "Shade" = "#32373AFF")
cols_age <- c("Early" = "#E76BF3",
              "Medium" = "#00B0F6",
              "Late" = "#F8766D")
cols_location <- c("Alto Pano" = "#B24422FF",
                   "Alto Tena" = "#4F9D4EFF",
                   "Talag" = "#4457A5FF")
# Add top anotation to HeatMap
top_info_ann <- HeatmapAnnotation(`Age Factor` = hm_pdata$Group,
                                  col = list(`Age Factor` = cols_levels),
                                  show_annotation_name = T,
                                  show_legend=F, 
                                  border = TRUE)
# Color scale
mycol <- colorRamp2(c(-2, 0, 2),
                    c("blue", "white", "red"))
# Heatmap matrix plotting
hm_plot <- Heatmap(hm_height,
                   col = mycol,
                   border_gp = grid::gpar(col = "black", lty = 0.05),
                   rect_gp = grid::gpar(col = "black", lwd = 0.75),
                   clustering_distance_columns = "euclidean",
                   clustering_method_columns = "complete",
                   top_annotation = top_info_ann,
                   right_annotation = hm_row_ann,
                   row_names_max_width = unit(10, "cm"),
                   show_heatmap_legend = FALSE,
                   row_km = 2, column_km = 2,
                   row_title = c("a", "b"))
hm_plot
```

![](Multivariate_Statistics_new_NEG_files/figure-markdown_github/unnamed-chunk-95-1.png)

Adding legends to heatmap.

``` r
# Color scale legend
lgd1 <- Legend(col_fun = mycol,
               title = "glog abundance",
               direction = "horizontal" )
# Factor levels legend
lgd2 <- Legend(labels = c("Light (Pos)",
                          "Shade (Neg)"),
               legend_gp = gpar(fill = cols_light),
               title = "Light factor", ncol = 1)
lgd3 <- Legend(labels = c("Early (0)",
                          "Medium (1)",
                          "Late (2)"),
               legend_gp = gpar(fill = cols_age),
               title = "Age factor", ncol = 1)
lgd4 <- Legend(labels = c("Alto Pano (B)",
                          "Alto Tena (C)",
                          "Talag (A)"),
               legend_gp = gpar(fill = cols_location),
               title = "Location factor", ncol = 1)
# Metabolite class Legend
lgd5 <- Legend(labels = c(unique(hm_fdata$Superclass)),
               legend_gp = gpar(fill = cols_metclass),
               title = "Metabolite superclass", ncol = 3)
```

Heatmap plot.

``` r
set.seed(2571)
# Converting to ggplot
gg_heatmap <- grid.grabExpr(draw(hm_plot))
gg_heatmap <- ggpubr::as_ggplot(gg_heatmap)
# Legends
all_legends <- packLegend(lgd1,
                          #lgd2,
                          lgd3,
                          #lgd4,
                          lgd5,
                          direction = "horizontal")
gg_legend <- grid.grabExpr(draw(all_legends))
gg_legend_fn <- ggpubr::as_ggplot(gg_legend)
# Heatmap plot
gcms_hm <- plot_grid(gg_legend_fn,
                     gg_heatmap, ncol = 1,
                     rel_heights = c(0.15, 0.880))
gcms_hm
```

![](Multivariate_Statistics_new_NEG_files/figure-markdown_github/unnamed-chunk-97-1.png)

``` r
# Save plot
#ggsave("E:/Paper/Estadistica_multivariable_negativo/HCA_subqc.pdf", width = 8, height = 8, units = "in", dpi = "print")
#ggsave("E:/Paper/Estadistica_multivariable_negativo/HCA_subqc.png", width = 8, height = 8, units = "in", dpi = "print")
```

# Heatmap and HCA of sample

Using the scaled data of the age heatmap, we extract sample data of
identified metabolites.

``` r
# Drop subQC
hm_no_subqc <- hm_no_qc[, hm_no_qc$Analysis_group != "Sub_Quality_Control"]
pData(hm_no_subqc) <- droplevels(pData(hm_no_subqc))
# Extracting identified metabolites
hm_age_spl <- hm_no_subqc[!is.na(hm_no_subqc@featureData@data$Metabolite),]
```

We improve heatmap visualization by adding the Tukey test as row
annotation. The Tukey test calculation code is available in this
notebook’s Univariate statistic section.

``` r
# Adding tukey test result
hm_age_spl <- join_fData(hm_age_spl, hm_tk_table_spl)
```

Row and top heatmap annotation.

``` r
set.seed(2571)
# Extracting feature height table
hm_height_spl <- exprs(hm_age_spl)
# Extracting sample information
hm_pdata_spl <- hm_age_spl@phenoData@data
# Extracting feature information
hm_fdata_spl <- hm_age_spl@featureData@data
# Adding row and column name
rownames(hm_height_spl) <- hm_fdata_spl$Metabolite
colnames(hm_height_spl) <- hm_pdata_spl$Group
# Add row anotation to HeatMap
hm_row_ann <- rowAnnotation(`Superclass` = hm_fdata_spl$Superclass,
                            #`Tukey test 2` = anno_text(hm_fdata_spl$Late,
                            #                           location = 0.5,
                            #                           just = "center",
                            #                           gp = gpar(fill = "#F8766D",
                            #                                     col = "#666666"),
                            #                           show_name = TRUE),
                            #`Tukey test 1` = anno_text(hm_fdata_spl$Medium,
                            #                           location = 0.5,
                            #                           just = "center",
                            #                           gp = gpar(fill = "#00B0F6",
                            #                                     col = "#666666"),
                            #                           show_name = TRUE),
                            #`Tukey test 0` = anno_text(hm_fdata_spl$Early,
                            #                           location = 0.5,
                            #                           just = "center",
                            #                           gp = gpar(fill = "#E76BF3",
                            #                                     col = "#666666"),
                            #                           show_name = TRUE),
                            col = list(`Superclass` = cols_metclass),
                            show_annotation_name = T,
                            show_legend = F)
# Factor levels color
cols_levels <- c("Shade conditions-Shade" = "#32373AFF",
                 "Period age-Early" = "#E76BF3",
                 "Light conditions-Light" = "#F5BC5CFF",
                 "Period age-Late" = "#F8766D",
                 "Location-Talag" = "#4457A5FF",
                 "Period age-Medium" = "#00B0F6",
                 "Location-Alto Tena" = "#4F9D4EFF",
                 "Location-Alto Pano" = "#B24422FF")
cols_light <- c("Light" = "#F5BC5CFF",
                "Shade" = "#32373AFF")
cols_age <- c("Early" = "#E76BF3",
              "Medium" = "#00B0F6",
              "Late" = "#F8766D")
cols_location <- c("Alto Pano" = "#B24422FF",
                   "Alto Tena" = "#4F9D4EFF",
                   "Talag" = "#4457A5FF")
# Add top anotation to HeatMap
top_info_ann <- HeatmapAnnotation(`Light Factor` = hm_pdata_spl$Light_Factor,
                                  `Age Factor` = hm_pdata_spl$Age_Factor,
                                  `Location Factor` = hm_pdata_spl$Location_Factor,
                                  col = list(`Light Factor` = cols_light,
                                             `Age Factor` = cols_age,
                                             `Location Factor` = cols_location),
                                  show_annotation_name = T,
                                  show_legend=F, 
                                  border = TRUE)
# Color scale
mycol_spl <- colorRamp2(c(-4, 0, 4),
                    c("blue", "white", "red"))
# Heatmap matrix plotting
hm_plot_spl <- Heatmap(hm_height_spl,
                       col = mycol,
                       border_gp = grid::gpar(col = "black", lty = 0.05),
                       rect_gp = grid::gpar(col = "black", lwd = 0.75),
                       clustering_distance_columns = "euclidean",
                       clustering_method_columns = "complete",
                       top_annotation = top_info_ann,
                       right_annotation = hm_row_ann,
                       row_names_max_width = unit(10, "cm"),
                       show_heatmap_legend = FALSE,
                       row_km = 2, column_km = 2,
                       row_title = c("a", "b"))
hm_plot_spl
```

![](Multivariate_Statistics_new_NEG_files/figure-markdown_github/unnamed-chunk-101-1.png)

Adding legends to heatmap.

``` r
# Color scale legend
lgd_hm_spl <- Legend(col_fun = mycol_spl,
                     title = "glog abundance",
                     direction = "horizontal" )
```

Heatmap plot.

``` r
set.seed(2571)
# Converting to ggplot
gg_heatmap_spl <- grid.grabExpr(draw(hm_plot_spl))
gg_heatmap_spl <- ggpubr::as_ggplot(gg_heatmap_spl)
# Legends
all_legends_spl <- packLegend(lgd_hm_spl,
                           lgd2,
                           lgd3, 
                           lgd4, 
                           lgd5,
                           direction = "horizontal")
gg_legend_spl <- grid.grabExpr(draw(all_legends_spl))
gg_legend_fn_spl <- ggpubr::as_ggplot(gg_legend_spl)
# Heatmap plot
gcms_hm_spl <- plot_grid(gg_legend_fn_spl,
                     gg_heatmap_spl, ncol = 1,
                     rel_heights = c(0.15, 0.880))
gcms_hm_spl
```

![](Multivariate_Statistics_new_NEG_files/figure-markdown_github/unnamed-chunk-103-1.png)

``` r
# Save plot
#ggsave("E:/Paper/Estadistica_multivariable_negativo/HCA_samples.pdf", width = 10, height = 8, units = "in", dpi = "print")
#ggsave("E:/Paper/Estadistica_multivariable_negativo/HCA_samples.png", width = 10, height = 8, units = "in", dpi = "print")
```

Finish a record.

``` r
finish_log()
```

    ## INFO [2025-04-08 11:25:10] Finished analysis. Tue Apr  8 11:25:10 2025
    ## Session info:
    ## 
    ## INFO [2025-04-08 11:25:10] R version 4.4.2 (2024-10-31 ucrt)
    ## INFO [2025-04-08 11:25:10] Platform: x86_64-w64-mingw32/x64
    ## INFO [2025-04-08 11:25:10] Running under: Windows 11 x64 (build 26100)
    ## INFO [2025-04-08 11:25:10] 
    ## INFO [2025-04-08 11:25:10] Matrix products: default
    ## INFO [2025-04-08 11:25:10] 
    ## INFO [2025-04-08 11:25:10] 
    ## INFO [2025-04-08 11:25:10] locale:
    ## INFO [2025-04-08 11:25:10] [1] LC_COLLATE=Spanish_Mexico.utf8  LC_CTYPE=Spanish_Mexico.utf8   
    ## INFO [2025-04-08 11:25:10] [3] LC_MONETARY=Spanish_Mexico.utf8 LC_NUMERIC=C                   
    ## INFO [2025-04-08 11:25:10] [5] LC_TIME=Spanish_Mexico.utf8    
    ## INFO [2025-04-08 11:25:10] 
    ## INFO [2025-04-08 11:25:10] time zone: America/Guayaquil
    ## INFO [2025-04-08 11:25:10] tzcode source: internal
    ## INFO [2025-04-08 11:25:10] 
    ## INFO [2025-04-08 11:25:10] attached base packages:
    ## INFO [2025-04-08 11:25:10]  [1] grid      stats4    parallel  stats     graphics  grDevices utils    
    ## INFO [2025-04-08 11:25:10]  [8] datasets  methods   base     
    ## INFO [2025-04-08 11:25:10] 
    ## INFO [2025-04-08 11:25:10] other attached packages:
    ## INFO [2025-04-08 11:25:10]  [1] cowplot_1.1.3               colorRamp2_0.0.1           
    ## INFO [2025-04-08 11:25:10]  [3] ComplexHeatmap_2.22.0       gt_0.11.1                  
    ## INFO [2025-04-08 11:25:10]  [5] agricolae_1.3-7             pmp_1.18.0                 
    ## INFO [2025-04-08 11:25:10]  [7] SummarizedExperiment_1.36.0 GenomicRanges_1.58.0       
    ## INFO [2025-04-08 11:25:10]  [9] GenomeInfoDb_1.42.1         IRanges_2.40.1             
    ## INFO [2025-04-08 11:25:10] [11] S4Vectors_0.44.0            MatrixGenerics_1.18.1      
    ## INFO [2025-04-08 11:25:10] [13] matrixStats_1.5.0           Hmisc_5.2-2                
    ## INFO [2025-04-08 11:25:10] [15] hexbin_1.28.5               ggrepel_0.9.6              
    ## INFO [2025-04-08 11:25:10] [17] batchCorr_0.2.5             notame_0.3.1               
    ## INFO [2025-04-08 11:25:10] [19] futile.logger_1.4.3         Biobase_2.66.0             
    ## INFO [2025-04-08 11:25:10] [21] BiocGenerics_0.52.0         gplots_3.2.0               
    ## INFO [2025-04-08 11:25:10] [23] here_1.0.1                  patchwork_1.3.0            
    ## INFO [2025-04-08 11:25:10] [25] lubridate_1.9.4             forcats_1.0.0              
    ## INFO [2025-04-08 11:25:10] [27] stringr_1.5.1               dplyr_1.1.4                
    ## INFO [2025-04-08 11:25:10] [29] purrr_1.0.2                 readr_2.1.5                
    ## INFO [2025-04-08 11:25:10] [31] tidyr_1.3.1                 tibble_3.2.1               
    ## INFO [2025-04-08 11:25:10] [33] tidyverse_2.0.0             magrittr_2.0.3             
    ## INFO [2025-04-08 11:25:10] [35] doParallel_1.0.17           ggplot2_3.5.1              
    ## INFO [2025-04-08 11:25:10] [37] iterators_1.0.14            foreach_1.5.2              
    ## INFO [2025-04-08 11:25:10] [39] shiny_1.10.0                devtools_2.4.5             
    ## INFO [2025-04-08 11:25:10] [41] usethis_3.1.0              
    ## INFO [2025-04-08 11:25:10] 
    ## INFO [2025-04-08 11:25:10] loaded via a namespace (and not attached):
    ## INFO [2025-04-08 11:25:10]   [1] later_1.4.1             bitops_1.0-9            rpart_4.1.23           
    ## INFO [2025-04-08 11:25:10]   [4] lifecycle_1.0.4         rstatix_0.7.2           gert_2.1.4             
    ## INFO [2025-04-08 11:25:10]   [7] rprojroot_2.0.4         lattice_0.22-6          MASS_7.3-61            
    ## INFO [2025-04-08 11:25:10]  [10] credentials_2.0.2       backports_1.5.0         openxlsx_4.2.7.1       
    ## INFO [2025-04-08 11:25:10]  [13] sass_0.4.9              rmarkdown_2.29          yaml_2.3.10            
    ## INFO [2025-04-08 11:25:10]  [16] remotes_2.5.0           httpuv_1.6.15           doRNG_1.8.6.1          
    ## INFO [2025-04-08 11:25:10]  [19] zip_2.3.1               askpass_1.2.1           sessioninfo_1.2.2      
    ## INFO [2025-04-08 11:25:10]  [22] pkgbuild_1.4.6          RColorBrewer_1.1-3      juicyjuice_0.1.0       
    ## INFO [2025-04-08 11:25:10]  [25] abind_1.4-8             pkgload_1.4.0           zlibbioc_1.52.0        
    ## INFO [2025-04-08 11:25:10]  [28] itertools_0.1-3         nnet_7.3-19             circlize_0.4.16        
    ## INFO [2025-04-08 11:25:10]  [31] GenomeInfoDbData_1.2.13 missForest_1.5          commonmark_1.9.2       
    ## INFO [2025-04-08 11:25:10]  [34] codetools_0.2-20        DelayedArray_0.32.0     xml2_1.3.6             
    ## INFO [2025-04-08 11:25:10]  [37] shape_1.4.6.1           tidyselect_1.2.1        UCSC.utils_1.2.0       
    ## INFO [2025-04-08 11:25:10]  [40] farver_2.1.2            base64enc_0.1-3         jsonlite_1.8.9         
    ## INFO [2025-04-08 11:25:10]  [43] GetoptLong_1.0.5        ellipsis_0.3.2          Formula_1.2-5          
    ## INFO [2025-04-08 11:25:10]  [46] systemfonts_1.1.0       tools_4.4.2             ragg_1.3.3             
    ## INFO [2025-04-08 11:25:10]  [49] Rcpp_1.0.14             glue_1.8.0              gridExtra_2.3          
    ## INFO [2025-04-08 11:25:10]  [52] SparseArray_1.6.1       xfun_0.50               withr_3.0.2            
    ## INFO [2025-04-08 11:25:10]  [55] formatR_1.14            fastmap_1.2.0           AlgDesign_1.2.1.1      
    ## INFO [2025-04-08 11:25:10]  [58] openssl_2.3.1           caTools_1.18.3          digest_0.6.37          
    ## INFO [2025-04-08 11:25:10]  [61] timechange_0.3.0        R6_2.5.1                mime_0.12              
    ## INFO [2025-04-08 11:25:10]  [64] textshaping_0.4.1       colorspace_2.1-1        gtools_3.9.5           
    ## INFO [2025-04-08 11:25:10]  [67] markdown_1.13           ggsci_3.2.0             generics_0.1.3         
    ## INFO [2025-04-08 11:25:10]  [70] data.table_1.16.4       httr_1.4.7              htmlwidgets_1.6.4      
    ## INFO [2025-04-08 11:25:10]  [73] S4Arrays_1.6.0          pkgconfig_2.0.3         gtable_0.3.6           
    ## INFO [2025-04-08 11:25:10]  [76] impute_1.80.0           XVector_0.46.0          htmltools_0.5.8.1      
    ## INFO [2025-04-08 11:25:10]  [79] carData_3.0-5           profvis_0.4.0           clue_0.3-66            
    ## INFO [2025-04-08 11:25:10]  [82] scales_1.3.0            png_0.1-8               knitr_1.49             
    ## INFO [2025-04-08 11:25:10]  [85] lambda.r_1.2.4          rstudioapi_0.17.1       rjson_0.2.23           
    ## INFO [2025-04-08 11:25:10]  [88] tzdb_0.4.0              reshape2_1.4.4          curl_6.1.0             
    ## INFO [2025-04-08 11:25:10]  [91] checkmate_2.3.2         nlme_3.1-166            GlobalOptions_0.1.2    
    ## INFO [2025-04-08 11:25:10]  [94] cachem_1.1.0            KernSmooth_2.23-24      miniUI_0.1.1.1         
    ## INFO [2025-04-08 11:25:10]  [97] foreign_0.8-87          pillar_1.10.1           vctrs_0.6.5            
    ## INFO [2025-04-08 11:25:10] [100] pcaMethods_1.98.0       ggpubr_0.6.0            urlchecker_1.0.1       
    ## INFO [2025-04-08 11:25:10] [103] promises_1.3.2          randomForest_4.7-1.2    car_3.1-3              
    ## INFO [2025-04-08 11:25:10] [106] xtable_1.8-4            cluster_2.1.6           htmlTable_2.4.3        
    ## INFO [2025-04-08 11:25:10] [109] evaluate_1.0.3          magick_2.8.5            cli_3.6.3              
    ## INFO [2025-04-08 11:25:10] [112] compiler_4.4.2          futile.options_1.0.1    rlang_1.1.4            
    ## INFO [2025-04-08 11:25:10] [115] crayon_1.5.3            rngtools_1.5.2          ggsignif_0.6.4         
    ## INFO [2025-04-08 11:25:10] [118] labeling_0.4.3          plyr_1.8.9              fs_1.6.5               
    ## INFO [2025-04-08 11:25:10] [121] stringi_1.8.4           viridisLite_0.4.2       munsell_0.5.1          
    ## INFO [2025-04-08 11:25:10] [124] V8_6.0.2                Matrix_1.7-1            hms_1.1.3              
    ## INFO [2025-04-08 11:25:10] [127] broom_1.0.7             igraph_2.1.3            memoise_2.0.1
